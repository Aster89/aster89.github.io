<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/main.css" media="screen"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>std::stream of consciousness</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Lato&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@200&display=swap');
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" defer src="js/language.js"></script>
    <script type="text/javascript" defer src="js/stackoverflow.js"></script>
    <script type="text/javascript" defer src="js/main.js"></script>
    <script type="text/javascript" defer src="js/tabs.js"></script>
    <script src="https://cdn.jsdelivr.net/g/lodash@4(lodash.min.js+lodash.fp.min.js)"></script>
    <!--link rel="stylesheet" href="highlight/styles/agate.min.css"-->
    <!--link rel="stylesheet" href="highlight/styles/androidstudio.min.css"-->
    <!--link rel="stylesheet" href="highlight/styles/base16/darcula.min.css"-->
    <!--link rel="stylesheet" href="highlight/styles/atom-one-dark.min.css"-->
    <link rel="stylesheet" href="highlight/styles/base16/solarized-dark.min.css">
    <link rel="icon" href="img/aster_logo.ico" type="image/x-icon">
    <script src="highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>
  <body onload="populateSOProfileWidged(); populateSORadarPlot();">
    <div class="body centered-container"> <!-- this double container pattern is to avoid getting blind when opening dev tools -->
      <header>
        <div class="top-bar box-shadow centers-based-flex">
          <div>
            <div>
              <input id="toggle" class="toggle hidden dark-light-mode" type="checkbox"/>
              <label for="toggle"></label>
              <div>
                <span lang="en">dark and light mode coming soon&hellip;-ish</span>
                <span lang="it">modalit√† chiara e scura in arrivo&hellip;</span>
              </div>
            </div>
          </div>
          <div>
            <ul class="social-links">
              <li><a href="https://github.com/Aster89" class="fa fa-github"></a></li>
              <li>
                <a id="stackoverflow-link" href="https://stackoverflow.com/users/5825294" class="fa fa-stack-overflow"></a>
                <div class="stackoverflow-widget flex box-shadow">
                  <img class="avatar" src="https://graph.facebook.com/10207587812237236/picture?type=large" alt="?"/>
                  <span class=reputation>?</span>
                  <ul class="badges flex">
                    <li class="gold">?</li>
                    <li class="silver">?</li>
                    <li class="bronze">?</li>
                  </ul>
                </div>
              </li>
              <li><a href="https://www.linkedin.com/in/enrico-maria-de-angelis-1b9b1a116/" class="fa fa-linkedin"></a></li>
            </ul>
          </div>
          <div>
            <ul class="choice-picker">
              <li>
                <input id="lang-it" class="hidden" type="radio" name="choose-language" onclick="setLanguage('it')">
                <label for="lang-it" title="Italiano">
                  <svg preserveAspectRatio="none" class="country-flag" xmlns="http://www.w3.org/2000/svg" width="1500" height="1000" viewBox="0 0 3 2">
                    <rect width="3" height="2" fill="#009246"/>
                    <rect width="2" height="2" x="1" fill="#fff"/>
                    <rect width="1" height="2" x="2" fill="#ce2b37"/>
                  </svg>
                </label>
              </li>
              <li>
                <input id="lang-en" class="hidden" type="radio" name="choose-language" onclick="setLanguage('en')">
                <label for="lang-en" title="English">
                  <svg preserveAspectRatio="none" class="country-flag" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="1200" height="600">
                    <clipPath id="s">
                    <path d="M0,0 v30 h60 v-30 z"/>
                    </clipPath>
                    <clipPath id="t">
                    <path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/>
                    </clipPath>
                    <g clip-path="url(#s)">
                    <path d="M0,0 v30 h60 v-30 z" fill="#012169"/>
                    <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
                    <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)" stroke="#C8102E" stroke-width="4"/>
                    <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
                    <path d="M30,0 v30 M0,15 h60" stroke="#C8102E" stroke-width="6"/>
                    </g>
                  </svg>
                </label>
              </li>
            </ul>
          </div>
        </div>
        <div class="page-title-and-author">
          <h1 id="page-title" class="page-title center-text-horz text-shadow">
            <code class="language-cpp"><span class="transparent-50">std::io</span>stream </code>
            <span class="handwriting"> of consciousness</span>
          </h1>
          <h4 class="handwriting page-author text-shadow">
            <a class="my-email" href="mailto:enricomaria.dean6elis@gmail.com">
              &mdash; Enrico Maria De Angelis
            </a>
          </h4>
        </div>
      </header>
      <div lang="en" class="wip center-text-horz text-shadow">Work in progress&hellip;</div>
      <div lang="it" class="wip center-text-horz text-shadow">Lavori in corso&hellip;</div>
      <nav> <!-- consider moving this into the header: http://www.cellbiol.com/bioinformatics_web_development/chapter-3-your-first-web-page-learning-html-and-css/introducing-html5-footer-header-nav-article-section-and-aside-elements/ -->
        <ul class="site-nav">
          <li class="switch-button">
            <input class="hidden" type="radio" name="nav-tabs" id="posts-radio" value="posts" checked>
            <label for="posts-radio" class="box-shadow">
              <span class="text">
                <span lang="en">Thoughts</span>
                <span lang="it">Pensieri</span>
              </span>
              <span class="icon fa fa-comment"></span>
            </label>
          </li>
          <li class="switch-button">
            <input class="hidden" type="radio" name="nav-tabs" id="projects-radio" value="projects">
            <label for="projects-radio" class="box-shadow">
              <span class="text">
                <span lang="en">Projects</span>
                <span lang="it">Progetti</span>
              </span>
              <span class="icon fa fa-code"></span>
            </label>
          </li>
          <li class="switch-button">
            <input class="hidden" type="radio" name="nav-tabs" id="suggested-books-radio" value="suggested-books">
            <label for="suggested-books-radio" class="box-shadow">
              <span class="text">
                <span lang="en">Readings</span>
                <span lang="it">Letture</span>
              </span>
              <span class="icon fa fa-book"></span>
            </label>
          </li>
          <li class="switch-button">
            <input class="hidden" type="radio" name="nav-tabs" id="about-me-radio" value="about-me">
            <label for="about-me-radio" class="box-shadow">
              <span class="text">Curriculum</span>
              <span class="icon fa fa-university"></span>
            </label>
          </li>
        </ul>
      </nav>
      <main id="main">
        <div class="main centered-container">
          <section class="tab-page" id="posts-tab">
            <article class="post-entry" id="c++-headers-and-libraries">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">15/10/2022</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/c++-logo.png" alt="">
                  <h2><a href="#c++-headers-and-libraries">Libraries in C++ &mdash; Header-only, static, dynamic, and lazily loaded</a></h2>
                </div>
                <div class="text-shadow">
                  <p>Just how many times have you cried because of a linker error?</p>

                  <p>I have. And so many times!</p>

                  <p>In hindsight, it is a pretty simple topic, but if you're so used
                  to just write code, and let the build system take care of compiling
                  and linking, then you'll probably hit linker errors infrequently
                  enough that you'll be tolerant of the frustration of those moments,
                  as long as some trial and error with build configuration files
                  will get you out of trouble.
                  </p>

                  <p>But sometimes you can't just hold the frustration anymore, and
                  you command yourself to dedicate some time to go to the bottom of this
                  topic; or, if not to the bottom, at least as low as it takes
                  for you to be happy with it, and no more frustrated by the
                  linking failures.
                  </p>

                  <p>So here's how I came to write this post: I started by creating
                  a directory with an evocative name, moved into it,
                  and started to play with C++ files in an attempt to
                  reproduce the frustrating workflow to better understand it.
                  When I started to erroneously delete the wrong file,
                  to forget what edit I made to file such and such, and
                  to feel more frustrated because didn't want to spend time
                  creating a <code>Makefile</code> to deal with this crap
                  on my behalf (after all, the <code>Makefile</code> would
                  be the guy shielding me away from exactly the topic I
                  was trying to understand, so probably using one would have
                  killed the purpose of the exercise), I decided
                  that writing a post to help myself track the progress of
                  my understanding was maybe a good idea.
                  </p>

                  <p>Eventually, this post turned out to be a personally
                  reworded collage of all the info I've found on the web that
                  helped me build a firmer understanding of the compilation
                  process, as well as of the various types of libraries that
                  exist. These two aspects are tightly bounded together,
                  in the sense that libraries (yours or third party's) are
                  exactly the expression of the fact that a program can
                  be written in separate and independently developed, tested,
                  and sometimes built pieces.
                  </p>

                  <p>(Little but important note: I'm on Linux, both at work and
                  in my personal time, so I will not even try giving Windows
                  examples; but most of this post should be useful anyway.)</p>

                  <h3 id="gcc-steps"><a href="#gcc-steps">The steps from source code to executable</a></h3>

                  <p>First of all, it is important to have an understanding of what
                  "compiling" a source codes into an executable really means. I've
                  quoted the word "compiling" because proper compilation is just
                  one of the steps that a compiler executes to go from source
                  code to executable program.
                  <a href="https://stackoverflow.com/a/9244030/5825294">This short but very good answer on StackOverflow</a>
                  outlines the phases that GCC goes through in the process.
                  </p>

                  <div class="collapsible-widget">
                    <input type="checkbox" value="" name="show more" id="steps-of-compilation-show-more"/>
                    <label for="steps-of-compilation-show-more">
                      <span>For instance&hellip;</span>
                      <span>For instance, if you have a single <code>mysource.cpp</code> file, when you execute</span>
                    </label>
                    <div class="collapsible">
                      <div>
                        <p></p>

                        <pre><code class="language-bash">g++ mysource.cpp -o mysource</code></pre>

                        <p>GCC in reality does the following (I'm barely rewording from the linked answer).
                        </p>

                        <ol>
                          <li id="c-preprocessor">It preprocesses the source code, by
                            stripping comments and expanding macros and
                            <code>#include</code>s; you can obtain this intermediate
                            product yourself by passing the <code>-E</code> to
                            <code>g++</code>:
                            <pre><code class="language-bash">g++ -E mysource.cpp -o mysource.ii</code></pre>
                          </li>
                          <li>It compiles that preprocessed source code to assembly, which you can
                            do yourself by means of the <code>-S</code> option:
                            <pre><code class="language-bash">g++ -S mysource.ii -o mysource.s</code></pre>
                          </li>
                          <li>It compiles the assembly into an object binary file, which you can do by means of
                            the <code>-c</code> option:
                            <pre><code class="language-bash">g++ -c mysource.s -o mysource.o</code></pre>
                          </li>
                          <li id="linker">Finally, it links the object
                            into the executable; you can do this by passing no options:
                            <pre><code class="language-bash">g++ mysource.o -o mysource</code></pre>
                            (you can list other object files too, if needed).
                          </li>
                        </ol>
                        <p>For the sake of accuracy, the flags <code>-E</code>,
                        <code>-S</code>, <code>-c</code> and none tell <code>g++</code>
                        at which step to <i>stop</i> the process, whereas where to begin
                        from is dictated simply the file you throw at it (not because of the extension
                        but because of what's inside it). To give a couple of examples,
                        </p>

                        <pre><code class="language-bash">g++ -S mysource.cpp -o mysource.s</code></pre>

                        <p>performs steps 1 and 2, whereas
                        </p>

                        <pre><code class="language-bash">g++ mysource.ii -o mysource</code></pre>

                        <p>executes steps 2, 3, and 4.
                        </p>
                      </div>
                    </div>
                  </div>

                  <h3 id="include-is-copy-and-paste"><a href="#include-is-copy-and-paste"><code>#include</code> is copy-and-paste</a></h3>

                  <p>As you might have guessed from its description,
                  step 1 is what takes care of, among other things,
                  <code>#include</code> directives; and you might also
                  wonder how simple this preprocessing might be,
                  considering that it happens so early in the process.
                  </p>

                  <p>And it is indeed a very simple thing:
                  </p>
                  <p style="text-align: center;" id="headers-are-copied-and-pasted">
                  <b>
                    <code>#include</code>ing a <i>file</i> is equivalent to
                    copying-and-pasting it into the includer.
                  </b>
                  </p>
                  <p>(If you know it already, you can <a href="#gcc-steps">skip the current section</a>.)
                  </p>
                  <p>
                  And I'm intentionally saying <i>file</i> instead of
                  <i>header</i>: <i>whatever</i> you <code>#include</code> is
                  just copy-and-pasted.
                  There's truly nothing other than copy-and-paste when you
                  <code>#include</code> something.
                  </p>

                  <p>Indeed, so little is special about <code>#include</code>, that
                  if you write a header without having that simple idea in mind, you can easily run in errors
                  which become obvious, once you are aware that there's just a copy-and-paste going on.
                  </p>
                  <p>Here's three flawed headers, each defining a different class,
                  one of which is included by the other two, which are in turn included
                  in the <code>main</code> program:
                  </p>
                  <pre><code class="language-cpp">// Foo.hpp
#include "Bar.hpp" // because every
struct Foo {       // Foo needs a Bar,
  Bar b;           // doesn't it?
};</code></pre>
                  <pre><code class="language-cpp">// Bar.hpp
struct Bar {
  // whatever
};</code></pre>
                  <pre><code class="language-cpp">// Baz.hpp
#include "Bar.hpp" // Even Baz needs a Bar!
struct Baz {
  Bar b;
};</code></pre>
                  <a href="https://godbolt.org/z/Pq8jK6zTf" target="_blank">
                    <pre><code class="language-cpp">// main.cpp
#include "Baz.hpp"
#include "Foo.hpp"
int main() {
  // not even trying to make
  // any use of the headers
}</code></pre>
                  </a>
                  <p>If you click on the last snippet, you'll see that the program
                  can't be compiled because it results in a redefinition of <code>Bar</code>,
                  the reason being that both <code>Foo.hpp</code> and <code>Baz.hpp</code>
                  are <code>#include</code>ing, i.e. copying-and-pasting, <code>Bar.hpp</code>.
                  </p>
                  <p>In other words, it's just like we tried to compile this source file alone:</p>
                  <pre><code class="language-cpp">// main.cpp
struct Bar {
  // whatever
};
struct Baz {
  Bar b;
};
struct Bar { // oops, I did it again
  // whatever
};
struct Foo {
  Bar b;
};
int main() {
  // not even trying to make
  // any use of the headers
}</code></pre>
                  <p>The source above, in fact, is the known as a <i>translation unit</i>,
                  which is the thing that the compiler compiles (or attempts to,
                  in this case) and which is roughly "the source file, conventionally named
                  with extension <code>.cpp</code>/<code>.cxx</code>/<code>.c</code>/whatever, that you feed
                  to the compiler, in which all <code>#include</code>s have been copied-and-pasted
                  (and all other <code>#</code>-directives have been "resolved", e.g. macro substituted, and so on)"
                  </p>

                  <div class="collapsible-widget">
                    <input type="checkbox" value="" name="show more" id="include-is-copy-and-paste-show-more"/>
                    <label for="include-is-copy-and-paste-show-more">
                      <p>In light of the steps we've seen earlier,
                      another, more direct way of verifying that <code>#include</code>
                      means copy-and-paste, is to examine the output of the following
                      command
                      </p>
                    </label>
                    <div class="collapsible">
                      <div>

                        <pre><code class="language-bash">g++ -E main.cpp -o main.ii</code></pre>

                        <p>which is successful and produces the following (it's not
                        a C++ file, but a file of type <code>initng</code> which contains
                        a mix of C++ syntax and something else, as you can see; more info
                        <a href="https://stackoverflow.com/questions/73763861/is-a-translation-unit-valid-c-and-is-a-translation-unit-for-gcc-the-output" target="_blank">here</a>):
                        </p>

                        <pre><code class="language-cpp"># 0 "main.cpp"
# 0 "&lt;built-in&gt;"
# 0 "&lt;command-line&gt;"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 0 "&lt;command-line&gt;" 2
# 1 "main.cpp"
# 1 "Bar.hpp" 1
struct Bar {

};
# 2 "main.cpp" 2
# 1 "Foo.hpp" 1
# 1 "Bar.hpp" 1
struct Bar {

};
# 2 "Foo.hpp" 2
struct Foo {
  Bar b;
};
# 3 "main.cpp" 2
int main() {
}</code></pre>

                        <p>where you can clearly see the duplicate definition of
                        <code>Bar</code>.
                        </p>
                      </div>
                    </div>
                  </div>

                  <p>But then why doesn't this problem occur when we include standard headers?
                  </p>
                  <p>The answer is simple: the standard headers use a device know as
                  <a href="https://en.wikipedia.org/wiki/Include_guard" target="_blank"><code>#include</code> guards</a>
                  to prevent multiple inclusions of the same header in the same translation unit,
                  and you should do so in every single one of your headers.
                  </p>
                  <p>To see how an include guard looks like, open any system header, such as
                  <code>iostream</code>, that on my system is located at <code>/usr/include/c++/12.2.0/iostream</code>
                  at the time of writing, and you'll see it has this structure:</p>
                  <pre><code class="language-cpp">// comments only
#ifndef _GLIBCXX_IOSTREAM
#define _GLIBCXX_IOSTREAM 1

// the content of the header

#endif /* _GLIBCXX_IOSTREAM */
// EOF</code></pre>
                  <p>And this is what gets copied-and-pasted in the source includer file,
                  resulting in the translation unit that the compiler tries to compile.
                  </p>
                  <p>When the compiler reaches the above snippet of code while compiling
                  a translation unit, it will verify that the macro <code>_GLIBCXX_IOSTREAM</code>
                  is <b><i>not</i></b> defined (because it's <code>#ifndef</code>, not <code>#ifdef</code>)
                  before actually pasting <code>// the content of the header</code>; it will also, at
                  that point, <code>#define</code> the macro that was not defined yet (the value <code>1</code> is
                  irrelevant), so that, should this snippet of code happen to occur again in this same
                  translation unit, <code>#ifndef _GLIBCXX_IOSTREAM</code> will not fire and the
                  <code>// the content of the header</code> will not be copied-and-pasted again.
                  </p>
                  <p>Another simpler way of enforcing an
                  <code>#include</code> guard, even though not standard, but
                  practically permitted by all major compilers, is to put
                  <a href="https://en.cppreference.com/w/cpp/preprocessor/impl#.23pragma_once" target="_blank"><code>#pragma once</code></a>
                  at the top of your header, and nothing else. What's the difference? Practically speaking,
                  none. Anyway, you can find more info
                  <a href="https://stackoverflow.com/questions/787533/is-pragma-once-a-safe-include-guard" target="_blank">here</a>
                  and at the previous link.
                  </p>

                  <h3 id="header-only-libraries"><a href="#header-only-libraries">Header-only libraries</a></h3>

                  <p>Knowing that <a href="#headers-are-copied-and-pasted"><code>#include</code>d headers are simply copied-and-pasted</a>,
                  you can easily imagine you can provide all the functionality you want to a
                  client of yours by providing them with one or more header files (and by
                  "header" I mean a proper one, with the <code>#include</code> guard)
                  defining all functions and classes they need.
                  <a href="https://stackoverflow.com/a/12673877/5825294" target="_blank">That's not necessarily
                    a good idea</a>,
                  but <a href="https://stackoverflow.com/a/12671412/5825294" target="_blank">sometimes it's the only option</a>,
                  for instance <a href="https://stackoverflow.com/questions/495021/why-can-templates-only-be-implemented-in-the-header-file" target="_blank">when you are defining templates</a>
                  (<a href="https://stackoverflow.com/a/495056/5825294" target="_blank">unless you already know all possible usages of your template</a>).
                  </p>

                  <div class="collapsible-widget">
                    <input type="checkbox" value="" name="show more" id="header-only-libraries-show-more"/>
                    <label for="header-only-libraries-show-more">
                      <p>Using such a library is as easy as adding the <code>#include</code> you need
                      into your source code,</p>
                    </label>
                    <div class="collapsible">
                      <div>

                        <pre><code class="language-cpp">// HeaderOnly.hpp
#pragma once
#include &lt;iostream&gt;
void foo(int i) {
    std::cout &lt;&lt; "Header-only library speaking, "
              &lt;&lt; i
              &lt;&lt; std::endl;
}</code></pre>
                        <pre><code class="language-cpp">// main.cpp
#include "HeaderOnly.hpp"
int main() {
  foo(101);
}</code></pre>
                        <p>and <b><i>it becomes part of your program as soon as during
                            <a href="#c-preprocessor">step 1, the preprocessing stage</a></i></b>, as
                        demonstrated by the following few commands
                        </p>

                        <pre><code class="language-bash">$ g++ -E main.cpp -o main.ii # preprocess main.cpp
$ rm HeaderOnly.hpp          # delete header to show it's not needed anymore
$ g++ main.ii -o main        # compile &amp; link
$ ./main                     # execute
Header-only library speaking, 101
                        </code></pre>

                        <p><a href="http://boostorg.github.io/hana/" target="_blank">Boost.Hana</a>
                        is a beautiful example of a header-only library,
                        designed to facilitate C++ meta-programming and suited for
                        computations on both types and values.
                        </p>
                      </div>
                    </div>
                  </div>

                  <h3 id="static-libraries"><a href="#static-libraries">Static libraries</a></h3>

                  <p>One of the drawbacks of header-only libraries is that they
                  <code>#include</code> all the headers their implementation needs;
                  which translates to what is known as <i>code bloat</i>: your translation
                  unit ends up being huge because of all the direct and indirect
                  <code>#include</code>s. Indeed, in the example above, you can well see
                  that the code inside <code>&lt;iostream&gt;</code> gets pasted into
                  <code>main.cpp</code>, even though <code>main.cpp</code> doesn't
                  need to know anything about <code>&lt;iostream&gt;</code>; all it
                  needs to know is how to call <code>foo</code>, i.e. it needs to
                  know its signature.
                  </p>
                  <p>
                  <a href="https://stackoverflow.com/questions/2174657/when-are-header-only-libraries-acceptable">Whether you should fear this problem and how
                    much</a> is another matter that this post does not address
                  at all, and it is influenced, among other things, by how smart the
                  compiler is.
                  </p>

                  <p>Anyway, what is the solution? There's basically no solution if you provide
                  templates that will be instantiated with types you don't know of, and
                  that's why templates are often accused of causing code bloat (see also
                  ¬ß9.1.1 from <i><a href="http://www.tmplbook.com/">C++ Templates - The Complete Guide - 2nd edition</a></i> for more
                  details), but for the simple case of non-template entities, such
                  as the <code>foo</code> function above,
                  the solution is simple enough.
                  Indeed, all <code>main.cpp</code> needs to know about <code>foo</code>
                  in order to be able to call it, is that it takes <code>void</code>
                  and returns <code>void</code>, i.e. that its type is <code>void(void)</code>,
                  or more simply <code>void()</code>. And all we need to do to make it aware
                  of this fact, is writing in it a declaration of <code>foo</code>,
                  i.e. <code>void foo();</code>.
                  As you might have guessed, we don't do that manually, but by
                  including an header which contains that declaration.
                  </p>
                  <p>So here's our solution in code:</p>
                  <ul>
                    <li>
                      <code>MyLib.hpp</code> declares <code>foo</code>,
                      <pre><code class="language-cpp">// MyLib.hpp
#pragma once
void foo();</code></pre>
                    </li>
                    <li>
                      <code>MyLib.cpp</code> defines it,
                      <pre><code class="language-cpp">// MyLib.cpp
#include "MyLib.hpp"
void foo() {
    std::cout &lt;&lt; "Hello" &lt;&lt; std::endl;
}</code></pre>
                    </li>
                    <li>
                      and <code>main.cpp</code> <code>#include</code>s the header and uses <code>foo</code>.
                      <a href="https://godbolt.org/z/z8q68rxz7" target="_blank">
                        <pre><code class="language-cpp">// main.cpp
#include "MyLib.hpp"
int main() {
  foo();
}</code></pre>
                      </a>
                    </li>
                  </ul>

                  <p>If you're wondering why <code>MyLib.cpp</code>
                  <code>#include</code>s its own header <code>MyLib.hpp</code>
                  the answer is that
                  there is such a myriad of scenarios where doing so is necessary
                  (e.g. <code>MyLib.hpp</code> defines an <code>inline</code>
                  variable to be used in client code as well as in the
                  implementation of some other exposed function), that
                  not doing it in a rare scenario like the one above
                  (more likely to happen in toy examples than in real code)
                  is just not worth the risk of forgetting it when it's needed.
                  You can read more about it
                  <a href="https://stackoverflow.com/questions/73248689/is-there-any-reason-i-should-include-a-header-in-the-associated-cpp-file-if-the" target="_blank">in this question I asked on
                    StackOverflow</a> and in the
                  associated answers.
                  </p>

                  <p id="the-building-process">The above example can be built like this
                  </p>
                  <pre><code class="language-bash">g++ -c main.cpp -o main.o   # compile main.cpp
g++ -c MyLib.cpp -o MyLib.o # compile MyLib.cpp
g++ main.o MyLib.o -o main  # link</code></pre>

                  <p>where the first two commands can be executed in any order,
                  because the translation units can be compiled independently,
                  thanks to the fact that the only thing that <code>main.cpp</code>
                  needs to know about <code>MyLib.cpp</code>, i.e. the declaration
                  of <code>foo</code>, has indeed been "pasted" into <code>main.cpp</code>
                  as well, via the inclusion of <code>MyLib.hpp</code>.</p>

                  <div class="collapsible-widget" style="--collapsible-transition-time: .8s;">
                    <input type="checkbox" value="" name="show more" id="static-libraries-show-more"/>
                    <label for="static-libraries-show-more">
                      <p>You can even use the program <code>nm</code> on both <code>*.o</code>
                      to list the symbols (not the executable code) they contain,
                      in order to observe how they relate:
                      </p>
                    </label>
                    <div class="collapsible">
                      <div>
                        <pre><code class="language-bash">$ nm main.o
0000000000000000 T main
                 U _Z3foov</code></pre>
                        <pre><code class="language-bash">$ nm MyLib.o
                 U __cxa_atexit
                 U __dso_handle
                 U _GLOBAL_OFFSET_TABLE_
0000000000000084 t _GLOBAL__sub_I__Z3foov
0000000000000000 T _Z3foov
0000000000000032 t _Z41__static_initialization_and_destruction_0ii
                 U _ZNSolsEPFRSoS_E
                 U _ZNSt8ios_base4InitC1Ev
                 U _ZNSt8ios_base4InitD1Ev
                 U _ZSt4cout
                 U _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_
0000000000000000 b _ZStL8__ioinit
                 U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc</code></pre>

                        <p><code>_Z3foov</code> is a so-called <i>mangled name</i> (which will become important
                        <a href="#mangled-name-2" id="mangled-name-1">later on</a>),
                        in which the compiler
                        encodes the signature of the specific overload of <code>foo</code> in use, and the line
                        <code>U _Z3foov</code> in <code>main.o</code> is the <i>undefined
                          reference to <code>`foo()'</code></i> (that <code>U</code> stands for "undefined"); the <code>0000000000000000 T _Z3foov</code>
                        line in <code>MyLib.o</code> indicates that that file contains the definition
                        of the same <code>foo</code> that <code>main.o</code> references.
                        </p>

                        <p>Another way to visualize this bond between the two files
                        that does not need an external program like <code>nm</code>
                        is to look at their assembly code. Let's obtain that code first
                        </p>

                        <pre><code class="language-bash">g++ -S main.cpp -o main.s
g++ -S MyLib.cpp -o MyLib.s</code></pre>

                        <p>and look for <code>_Z3foov</code> in the two files
                        <code>main.s</code> and <code>MyLib.s</code>.
                        </p>

                        <pre><code class="language-x86asm">.file	"main.cpp"
	.text
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	pushq	%rbp
	.cfi_def_cfa_offset 16
	.cfi_offset 6, -16
	movq	%rsp, %rbp
	.cfi_def_cfa_register 6
	call	_Z3foov@PLT
	movl	$0, %eax
	popq	%rbp
	.cfi_def_cfa 7, 8
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits</code></pre>

                  <pre><code class="language-x86asm">	.file	"static.cpp"
	.text
	.local	_ZStL8__ioinit
	.comm	_ZStL8__ioinit,1,1
	.section	.rodata
	.align 8
.LC0:
	.string	"Hello world, static library speaking"
	.text
	.globl	_Z3foov
	.type	_Z3foov, @function
_Z3foov:
.LFB1761:
# more stuff</code></pre>
                      </div>
                    </div>
                  </div>

                  <p><a href="#the-building-process">Going back to the building process</a>,
                  once again, it can be executed in one step,
                  but I think it's instructive to see what happens if you try linking
                  without telling the linker where <code>MyLib.o</code> is. What you get
                  is an error from the linker, <code>ld</code>, complaining about
                  an <b><i>undefined reference</i></b> to <code>foo()</code>:</p>

                  <pre><code class="language-bash">$ g++ main.o -o main # forgot MyLib.o
/usr/bin/ld: main.o: in function `main':
main.cpp:(.text+0x5): undefined reference to `foo()'
collect2: error: ld returned 1 exit status</code></pre>

                  <p>And maybe it's even important to know how this error differs
                  from the one you get if you forget to <code>#include "MyLib.hpp"</code>
                  in <code>main.cpp</code>, which complains about
                  <code>foo</code> being <b><i>not declared</i></b>. This is an
                  error that happens at compile-time, rather than link time,
                  because <code>main.cpp</code> doesn't even know <code>foo</code>'s
                  signature.</p>

                  <pre><code class="language-bash">$ g++ -c main.cpp -o main.o
main.cpp: In function ‚Äòint main()‚Äô:
main.cpp:3:5: error: ‚Äòfoo‚Äô was not declared in this scope
    3 |     foo();
      |     ^~~</code></pre>

                  <p>(More precisely, the error above happens during
                  the compilation to assembly, i.e. you get the same
                  error if you run the command <code>$ g++ -S main.cpp -o main.s</code>.)</p>

                  <p>At this point one question that might arise is:
                  where did the code in <code>MyLib.cpp</code> end up
                  being? You can verify, by getting rid of the <code>*.o</code>
                  files, that <code>main</code> works well in isolation:
                  </p>

                  <pre><code class="language-bash">$ rm MyLib.o main.o
$ ./main
Hello</code></pre>

                  <p>Therefore,
                  you can also be sure that all the code it needs, including
                  the one originally in <code>MyLib.cpp</code> and compiled
                  in <code>MyLib.o</code>, is indeed
                  embedded into the binary named <code>main</code>.
                  In other words, <b><i>the code of a static library becomes
                  part of the executable file <a href="#linker">at link time</a></i></b>.
                  </p>

                  <div class="collapsible-widget">
                    <input type="checkbox" value="" name="show more" id="static-libraries-are-dot-a-show-more"/>
                    <label for="static-libraries-are-dot-a-show-more">
                      <p>To be accurate, by the name <i>static libraries</i> go those files conventionally
                      named <code>something.a</code>, which are not one single <code>*.o</code> file, but an archive
                      containing one or more of those.
                      </p>
                    </label>
                    <div class="collapsible">
                      <div>

                        <p>For instance the following command creates a properly known static library containing one
                        object file only
                        </p>

                        <pre><code class="language-bash">ar rcs libMyLib.a MyLib.o</code></pre>

                        <p>which you can link like this</p>

                        <pre><code class="language-bash">g++ main.o libMyLib.a -o main</code></pre>

                        <p>The reason why I chose the name <code>libMyLib.a</code> instead of
                        <code>MyLib.a</code> is that this is customary for static libraries,
                        so much that there's another syntax for linking them which assumes the
                        <code>lib</code> prefix in the filename:
                        </p>

                        <pre><code class="language-bash">g++ main.o -lMyLib -L. -o main</code></pre>

                        <p>where <code>-l</code><i><code>name</code></i> tells the linker to look for
                        a file named <i><code>libname.a</code></i> and <code>-L</code><i><code>dir</code></i>
                        tells it to look for that file in the directory <i><code>dir</code></i>. Indeed,
                        if we had named the archive <code>MyLib.a</code>, the command above would error
                        with a fairly understandable wording:
                        </p>

                        <pre><code class="language-bash">/usr/bin/ld: cannot find -lMyLib: No such file or directory
/usr/bin/ld: note to link with ./MyLib.a use -l:MyLib.a or rename it to libMyLib.a
collect2: error: ld returned 1 exit status</code></pre>

                      </div>
                    </div>
                  </div>

                  <h3 id="dynamic-libraries"><a href="#dynamic-libraries">Dynamic libraries</a></h3>

                  <p>So we've verified that when linking a <a href="#static-libraries">static library</a>
                  against a client code, the library's and client's code end up in the same produced executable.
                  Therefore, if the static library changes, i.e. if its author changes <code>MyLib.cpp</code>,
                  recompiles it into <code>MyLib.o</code> and gives the latter to you, you still have
                  to re-link your <code>main.o</code> against the new <code>MyLib.o</code>, otherwise you'll
                  be still using the old one.
                  </p>

                  <p>Is there a way that the library writer can compile the library such that they're
                  free to change the implementation of the library without forcing us to re-link?
                  Yes there is.
                  </p>

                  <p>Let's make just one little change to the workflow
                  described above. The source and header files stay the same,
                  but we compile the library with a different command:
                  </p>

                  <pre><code class="language-bash">g++ -fPIC -shared MyLib.cpp -o libMyLib.so</code></pre>

                  <p>Then we link using the same command as before:</p>

                  <pre><code class="language-bash">$ g++ main.o libMyLib.so -o main</code></pre>

                  <p>If we try to run the executable straight away as we did earlier, though,
                  we get an error,</p>

                  <pre><code class="language-bash">$ ./main
./main: error while loading shared libraries: libMyLib.so: cannot open shared object file: No such file or directory</code></pre>

                  <p>This error tells us two things:</p>
                  <ul>
                    <li>"<code>error while loading shared libraries</code>"
                      tells us that linking doesn't embed the library
                      executable code into the <code>main</code>
                      executable;</li>

                    <li>"<code>No such file or directory</code>" tells us that the runtime system
                      that attempted to start the program couldn't find the library, so
                      we need a way to instruct it about where to look
                      for it.
                    </li>
                  </ul>

                  <p>The solution here is easy: we can pass the missing
                  information via the <code>LD_LIBRARY_PATH</code> macro,
                  </p>

                  <pre><code class="language-bash">$ LD_LIBRARY_PATH='.' ./main # . is the current dir, where the library is
Hello</code></pre>

                  <p>Now it should be clear that if we delete <code>MyLib.so</code>
                  and run <code>main</code>, we get the same error as before,</p>

                  <pre><code class="language-bash">$ rm MyLib.so
$ LD_LIBRARY_PATH='.' ./main
./main: error while loading shared libraries: libMyLib.so: cannot open shared object file: No such file or directory</code></pre>

                  <p>but a more interesting observation is that we can
                  <i>change</i> <code>MyLib.cpp</code> (but leaving its interface
                  intact, i.e. we <i>don't</i> change <code>MyLib.hpp</code>),
                  recompile the library, and executing <code>main</code> will
                  reflect those changes, without any need to re-link:
                  </p>

                  <pre><code class="language-bash">
$ sed -i 's/Hello/Bye/' MyLib.cpp            # change Hello to Bye (you can do it any other way)
$ g++ -fPIC -shared MyLib.cpp -o libMyLib.so # recompile only the library
$ LD_LIBRARY_PATH='.' ./main
Bye</code></pre>

                  <p>Therefore, an author of a dynamic library
                  can do all the changes they like to the implementation of the
                  library (but not to the interface they promised), share the
                  binaries with the client, and the client will just have to
                  overwrite the old shared objects with the new ones, and the
                  executable will pick them up. In other words, <i><b>the code
                  of a dynamic library becomes part of your program at
                  <strike>runtime</strike> startup time.</b></i>
                  And this means the <code>*.so</code> file must be there when
                  you run <code>main</code>, even if <code>main</code> doesn't
                  make use of it (try removing the call to <code>foo()</code> from
                  inside <code>main.cpp</code>, recompile and relink it against
                  <code>libMyLib.so</code>, then delete <code>libMyLib.so</code>,
                  run <code>LD_LIBRARY_PATH='.' ./main</code> and you'll get same error as above).
                  </p>

                  <p>Why have I specifically written <i>"startup time"</i>
                  rather than <i>"runtime"</i>? Because the runtime system
                  loads the library even before the actual program starts
                  executing. How can we verify this? Simple: put a print
                  statement in <code>main.cpp</code> before the call to
                  <code>foo</code>, like this
                  </p>
                  <pre><code class="language-cpp">// main.cpp
#include "MyLib.hpp"
int main() {
  std::cout &lt;&lt; "before" &lt;&lt; std::endl;
  foo();
}</code></pre>
                  <p>and then</p>

                  <pre><code class="language-bash">$ g++ -c main.cpp -o main.o
$ g++ main.o libMyLib.so -o main
$ rm libMyLib.so
$ LD_LIBRARY_PATH='.' ./main
./main: error while loading shared libraries: libMyLib.so: cannot open shared object file: No such file or directory
                  </code></pre>
                  <p>As you can see, no trace of the text <i>before</i>: the executable
                  hasn't even started.</p>

                  <p>This also means, though, that once the executable has started,
                  you can indeed delete the <code>.so</code> file, and the
                  running process will not be impacted, which you can verify by
                  repeating the above process, but changing this
                  </p>

                  <pre><code class="language-cpp">  std::cout &lt;&lt; "before" &lt;&lt; std::endl;</code></pre>

                  <p>to this</p>

                  <pre><code class="language-cpp">  int dummy;
  std::in &lt;&lt; dummy;</code></pre>

                  <p>re-compiling, re-linking, starting the program, deleting
                  <code>libMyLib.so</code> while the executable is waiting for
                  your input, and then entering the input.  The program will do
                  just fine.
                  </p>

                  <p>At this point, if you cannot guess already what the
                  next section is about, I think you probably will if I ask you
                  two questions:
                  </p>

                  <ul>
                    <li>How much does loading a library cost?</li>
                    <li>How many libraries are we realistically loading in a non-toy application?</li>
                  </ul>

                  <p>Clearly, the answers vary wildly across the use cases, but
                  the point is that loading a library does have a cost, and for
                  big programs, especially those with multiple functionalities
                  that are not all necessarily needed at the same time (or not
                  at all if the user chooses not to use them in a session of
                  the program), there can be many of those costs; as many that
                  they can add up at the expense of the startup time of the
                  program and, consequently, of the user experience.
                  </p>

                  <p>You might now be wondering whether a way exists to load a
                  dynamic library only when it is needed. This is the question
                  that leads us to the final section of this post‚Ä¶</p>

                  <h3 id="dynamic-libraries-lazy-load"><a href="#dynamic-libraries-lazy-load">Lazily loaded dynamic libraries</a></h3>

                  <p>If the library is not loaded by the runtime system as soon
                  as we start the program, then who takes of care of loading it?
                  There's no other answer than "the program" itself. After all,
                  that's what we want: the program logic to decide when and
                  if to load the library. And the API to do so is part of the
                  GNU C library.</p>

                  <p>Before showing the code, I think it is important to stress
                  a few points:</p>

                  <ul>
                    <li>we already have a dynamic library in place, and from
                      the perspective of the clients of the library, that's not
                      gonna change;
                    </li>
                    <li>the library implementer can change the implementation of it
                      (i.g. the <code>MyLib.cpp</code> file), but as long as
                      they keep the interface (i.e. the <code>MyLib.hpp</code>)
                      unchanged, for the clients it's just like the library
                      doesn't change;
                    </li>
                    <li>the lazy or eager policy in loading the library is
                      a decision made on the client side, which the implementer
                      of the library knows nothing about.
                    </li>
                  </ul>

                  <p>That being said, it should be clear that we will now only
                  play the role of the library clients, with the aim of loading
                  the library lazily, during run time, rather than eagerly,
                  during launch time.  For this reason, we'll only have to
                  review two things:
                  </p>
                  <ol>
                    <li>
                      the actual code of our application, <code>main.cpp</code>,
                      to make it actually handle the loading of the library,
                    </li>
                    <li>
                      and the command to build our application (which is fairly
                      straightforward, if not unsatisfying).
                    </li>
                  </ol>

                  <p>As regards the first point, <code>main.cpp</code> is
                  now a bit more complicated, because it needs to deal with the
                  possibility of failure when loading the library and/or
                  reading the symbol(s) we are looking for, but the comments
                  should make most of it understandable.
                  </p>

                  <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;dlfcn.h&gt;

#include "MyLib.hpp"

int main() {

    // try opening the library
    void * lib = dlopen("./libMyLib.so", RTLD_LAZY);

    // verify opening was fine, or error out
    if (!lib) {
        std::cerr &lt;&lt; "Error (when opening the library \"./libMyLib.so\"): " &lt;&lt; dlerror() &lt;&lt; std::endl;
        return 1; // if we return here, echo $? in the shell will print 1
    }

    // so far so good
    dlerror(); // reset the error status

    // try loading the symbol `foo`
    void * fooPtr = dlsym(lib, "foo");
    auto error = dlerror();

    // verify loading symbol was fine, or error out
    if (error) {
        std::cerr &lt;&lt; "Error (when loading the symbol `foo`): " &lt;&lt; error &lt;&lt; std::endl;
        return 2; // if we return here, echo $? in the shell will print 2
    }

    // so far so good
    dlerror(); // reset the error status

    // cast foo to the function type we know and call it
    using Foo = decltype(foo);
    ((Foo*)fooPtr)();
}</code></pre>

                  <p>As regards the second point, the solution is simple: we just
                  don't link against the library, because we are delegating the
                  task of "establishing a connection" with the library to our
                  program itself.
                  </p>

                  <p>However, surprisingly enough (at least for those of us who
                  are new to this topic) &hellip;
                  </p>

                  <pre><code class="language-bash">$ g++ main.cpp -o main                       # compile and link main
$ g++ -fPIC -shared MyLib.cpp -o libMyLib.so # compile the library
$ ./main                                     # run
Error (when loading the symbol `foo`): ./libMyLib.so: undefined symbol: foo
$ echo $?                                    # print last return status
2</code></pre>

                  <p>&hellip; the runtime doesn't seem to find the symbol <code>foo</code>,
                  even though the library loading succeeds (indeed, we exited with
                  <code>return 2</code>, not <code>return 1</code>).
                  </p>

                  <p>Without dedicating enough time to think about why that was happening,
                  I rushed at <a href="https://stackoverflow.com/questions/73595909/dlopen-succeeds-or-at-least-seems-to-but-then-dlsym-fails-to-retrieve-a-symbol">asking on StackOverflow</a>
                  to discover something which is obvious in hindsight:
                  since in C++ functions can be overloaded, the name of function
                  alone is not enough, in general, to unequivocally address
                  what could be one of many overloads.
                  To know what function to call, the linker has to know the
                  function signature too, so the compiler has to provide it in
                  the object file, and it does so by presenting each overload
                  of <code>foo</code> with a differently mangled name (the thing
                  I mentioned <a href="#mangled-name-1" id="mangled-name-2">earlier</a>), where
                  the mangling encodes the signature. In short, if we change
                  </p>

                  <pre><code class="language-cpp">    void * fooPtr = dlsym(lib, "foo");</code></pre>

                  <p>to</p>

                  <pre><code class="language-cpp">    void * fooPtr = dlsym(lib, "_Z3foov");</code></pre>

                  <p>the problem is solved.</p>

                  <p>This solution, however, is non-portable, as noted in
                  <a href="https://stackoverflow.com/questions/73595909/dlopen-succeeds-or-at-least-seems-to-but-then-dlsym-fails-to-retrieve-a-symbol#comment129976515_73596011">a comment</a>
                  to the linked question. In the case that the library provides
                  a single overload of <code>foo</code>, then an alternative solution
                  (from the perspective of the library writer) is to declare <code>foo</code>
                  like this
                  </p>

                  <pre><code class="language-cpp">extern "C" void foo();</code></pre>

                  <p>so its name will not be mangled in the shared object file
                  (in C there's no function overloading, hence no reason to
                  mangle names), and we can pass just <code>"foo"</code> to
                  <code>dlsym</code>.
                  </p>

                  <p>If, instead, the library provides more overloads,
                  then <code>extern "C"</code> is not a viable solution, and
                  one has to deal with mangled names. I'm not sure a portable
                  solution exists, but
                  <a href="https://stackoverflow.com/questions/24088464/dynamic-loading-without-extern-c">here</a>'s
                  a relevant question with some possible solution outlined (the
                  lengthy comments to the question are very informative, so I
                  suggest to have a read of those too). Incidentally, I'm not
                  sure how much the necessity of inspecting a library for mangled
                  names has to do, if anything at all, with the question of
                  whether the application should still include a header
                  from the library (there's an hint of this aspect of the matter
                  in the comments
                  <a href="https://stackoverflow.com/a/74023934/5825294" target="_blank">here</a>).
                  </p>

                  <p>Leaving aside the topic of shared libraries providing overloaded
                  functions, and staying in the realm of what is possible with <code>extern "C"</code>
                  (or, alternatively, writing non-portable code by hard coding mangled names
                  in the client code),
                  it should be clear that with such a mechanism (I mean, <code>dlopen</code>+<code>dlsym</code>,
                  not only can we load a library lazily, i.e. only when its needed,
                  but we can also take into account the scenario where the library
                  is missing, and provide a fallback alternative to it.
                  </p>
                  <p>Below I've included one such example. It it is made up of
                  </p>
                  <ul>
                    <li>a <code>main.cpp</code> that tries to load a library
                      <code>libMyLib.so</code> and, if that is not available,
                      falls back on a default library;
                    </li>
                    <li>a default library <code>DefaultLib.cpp</code>/<code>DefaultLib.hpp</code>;</li>
                    <li>a <code>libMyLib</code> library, <code>MyLib.cpp</code>/<code>MyLib.hpp</code>.</li>
                  </ul>
                  <p>
                  It can be compiled and used like this:
                  </p>

                  <pre><code class="language-bash">$ g++ -c main.cpp -o main.o                  # compile main
$ g++ -c DefaultLib.cpp -o DefaultLib.o      # compile default library
$ g++ DefaultLib.o main.o -o main            # link
$ ./main                                     # run (libMyLib.so is not available)
Slow, old, rotten version
$ g++ -fPIC -shared MyLib.cpp -o libMyLib.so # compile shared library
$ ./main                                     # run (libMyLib.so is available)
Fast version (you've I paid big money for it)</code></pre>

                  <p>Here you can see that <code>main</code> can be run
                  with or without the shared library being available,
                  and its logic will act accordingly. (By the way, we
                  don't need to prepend <code>LD_LIBRARY_PATH='.'</code>
                  because we load the library from where we know it is,
                  see <code>"./libMyLib.so"</code> in the code below.)
                  </p>

                  <p>Below are the source codes.</p>

                  <pre><code class="language-cpp">// DefaultLib.hpp
#pragma once
namespace old {
void foo();
}</code></pre>
                  <pre><code class="language-cpp">// DefaultLib.cpp
#include "DefaultLib.hpp"
#include &lt;iostream&gt;
namespace old {
void foo() {
    std::cout &lt;&lt; "Slow, old, rotten version" &lt;&lt; std::endl;
}
}</code></pre>
                  <pre><code class="language-cpp">// MyLib.hpp
#pragma once
extern "C" void foo();</code></pre>
                  <pre><code class="language-cpp">// MyLib.cpp
#include "MyLib.hpp"
#include &lt;iostream&gt;
void foo() {
    std::cout &lt;&lt; "Fast version (you've I paid big money for it)" &lt;&lt; std::endl;
}</code></pre>
                  <a href="https://godbolt.org/z/5Mbv6x53e" target="_blank">
                    <pre><code class="language-cpp">// main.cpp
#include "DefaultLib.hpp"
#include "MyLib.hpp"
#include &lt;dlfcn.h&gt;
#include &lt;iostream&gt;

int main() {

    // try opening the library
    void * lib = dlopen("./libMyLib.so", RTLD_LAZY);

    // verify opening was fine, or use default version
    if (!lib) {
        old::foo();
        return 0;
    }

    // so far so good
    dlerror(); // reset the error status

    // try loading the symbol `foo`
    void * fooPtr = dlsym(lib, "foo");
    auto error = dlerror();

    // verify loading symbol was fine, or use default version
    if (error) {
        old::foo();
        return 0;
    }

    // so far so good
    dlerror(); // reset the error status

    // retrieve type of foo, as we expect it based on the header
    using Foo = decltype(foo);

    // and cast fooPtr to a pointer to that type before using it
    ((Foo*)fooPtr)();
}</code></pre>
                  </a>

                  <p>Click on the last one to see the complete example
                  on Compiler Explorer; comment the <code>add_library(‚Ä¶)</code>
                  line in the <code>CMakeLists.txt</code> file to hide the library, thus
                  triggering the use of the default one; also, consider that I
                  had to change <code>"./libMyLib.so"</code> to
                  <code>"build/libMyLib.so"</code> because that's where CE puts
                  the shared object; I didn't know,
                  <a href="https://stackoverflow.com/questions/74000607/can-i-compile-and-dlopen-a-dynamic-library-in-compiler-explorer">I just asked</a>.
                  </p>

                  <h3 id="debugging-libraries"><a href="#debugging-libraries">Yeah, but how do I debug library code? &mdash; Demo</a></h3>

                  <p>As far as header-only libraries are concerned, debugging
                  is just as you would expect: you have the library code,
                  you include it into yours, you compile the way you like, e.g.
                  enabling debugging flags, and you step into the library code
                  just as it was your own code. Easy-peasy.
                  </p>

                  <p>As regards the other types of libraries we've reviewed, i.e.
                  static and dynamic libraries, those normally come in compiled
                  form (shared object, library archives, &hellip; whatever),
                  is simply no C++ source code you can step through, &hellip; unless
                  you do have the source code from which the library was compiled.
                  So we can say that the possible scenarii are the following:
                  </p>

                  <ol>
                    <li>The library is not open source. In this case you just
                      don't and can't legally have the source code, so you just
                      can't step through it with a debugger. Is is a problem? No,
                      as most likely you paid for the library, so you can report
                      a bug and expect that the vendor will debug and fix the bug.
                    </li>
                    <li>The library is open source and you installed it from
                      pre-compiled binaries. In this case you can't step trough
                      the code because, just as in case 1, you don't have it.
                    </li>
                    <li>
                      The library is open source and you have built it from
                      source on your system. In this case you do have the
                      source code you want to step through, with one caveat:
                      most likely the library was built with full
                      optimizations on, in order to target performance, so
                      you'll probably see a lot of jumps when debugging, and
                      you'll not be able to set breakpoints on every single
                      executable line of code, because many have been optimized
                      always. If that's the case, you might want to
                      (temporarily) recompile the library with debug flags on
                      (e.g. <code>-g -O0</code> with GCC) before debugging.
                    </li>
                  </ol>

                  <p>A tricky bit about debugging a non-header-only library,
                  though, is that the debug symbols have to be loaded during
                  the debug session. Depending on what debug adapter you use,
                  this could happen automatically or not, and the behavior
                  of the same debug adapter can likely depending on how you
                  configure it.
                  </p>

                  <p>In the following screen cast I'll show how I step through
                  the last example with the debugger; initially I'll use the
                  <a href="https://github.com/microsoft/vscode-cpptools"><code>vscode-cpptools</code></a>
                  adapter with setting
                  <a href="https://code.visualstudio.com/docs/cpp/launch-json-reference#_symbolloadinfo"><code>"symbolLoadInfo": { "loadAll": false, "exceptionList": ""}</code></a>,
                  which fundamentally means "do not load debug symbols from
                  libraries, and make no exception", so you'll see that I
                  need to manually load the symbols from the library to enable
                  a breakpoint in that library code. Then I'll show you the
                  same workflow with
                  <a href="https://github.com/vadimcn/vscode-lldb">CodeLLDB</a>,
                  which, for some reason I don't know, ignores the setting I
                  mentioned earlier (maybe it uses another syntax and ignores
                  this one because it doesn't understand it?) and loads the
                  symbols as soon as <code>dlopen</code> returns.
                  </p>

                  <a href="https://asciinema.org/a/YYqV5bKpLiH64hGdHRfM2N08I" target="_blank"><img src="https://asciinema.org/a/YYqV5bKpLiH64hGdHRfM2N08I.svg" /></a>

                  <h3 id="libraries-summary">Conclusions and summary</h3>

                  <p>Creating all the examples above and playing with each of them
                  helped me have a better understanding of what <i>compiling</i> and
                  <i>linking</i> actually are, how different parts of a program
                  know about each other, and what the difference is between static
                  and dynamic libraries.
                  </p>

                  <p>Here are the main points.</p>
                  <ul>
                    <li><code>#include &lt;foo&gt;</code> just means
                      "copy-and-paste the file <code>foo</code> right here".
                    </li>
                    <li>A header-only library is a library which is made up
                      entirely of&hellip; headers, which you <code>#include</code>
                      in your files, and that becomes part of your program as
                      soon as the preprocessing stage of the building process
                      happens.
                    </li>
                    <li>A static library is an already compiled piece of code
                      (often in the form of an object file, <code>someObj.o</code>,
                      or of an archive, <code>someLib.a</code>) which you
                      link against your compiled program; the result is
                      one executable that contains everything it needs.
                    </li>
                    <li>A dynamic library is, too, an already compiled piece
                      of code, but at link time it doesn't become part of the
                      generated executable; the latter, in fact, only has references
                      to the entities it needs from the library, and those references
                      are resolved when your program is launched.
                    </li>
                    <li>A dynamic library, alternatively, can be loaded at
                      run time by the program itself, via <code>dlopen</code>
                      and <code>dlsym</code>, removing entirely the necessity of liking
                      your program against it.</li>
                  </ul>

                  <h3 id="library-sources">Referenced sources</h3>


                  <p>Below are most of the sources (some of which already linked off the text above) I found invaluable in helping me understanding the topic
                  I've been writing about today.
                  </p>

                  <ul>
                    <li><a href="https://stackoverflow.com/questions/24088464/dynamic-loading-without-extern-c">Dynamic Loading Without <code>extern "C"</code></a></li>
                    <li><a href="https://stackoverflow.com/questions/73248689/is-there-any-reason-i-should-include-a-header-in-the-associated-cpp-file-if-the">Is there any reason I should include a header in the associated cpp file if the former only provides declarations the latter defines?</a></li>
                    <li><a href="https://stackoverflow.com/questions/73595909/dlopen-succeeds-or-at-least-seems-to-but-then-dlsym-fails-to-retrieve-a-symbol"><code>dlopen</code> succeeds (or at least seems to) but then <code>dlsym</code> fails to retrieve a symbol from a shared library</a></li>
                    <li><a href="https://stackoverflow.com/questions/56747328/loading-shared-library-dynamically-using-dlopen">Loading shared library dynamically using <code>dlopen</code></a></li>
                    <li><a href="https://stackoverflow.com/questions/9688200/difference-between-shared-objects-so-static-libraries-a-and-dlls-so">Difference between shared objects (<code>.so</code>), static libraries (<code>.a</code>), and DLL's (<code>.so</code>)?</a></li>
                    <li><a href="https://stackoverflow.com/questions/10358745/how-to-use-libraries">How to use Libraries</a></li>
                    <li><a href="https://stackoverflow.com/questions/6177498/whats-the-difference-between-object-file-and-static-libraryarchive-file">What's the difference between object file and static library(archive file)?</a></li>
                    <li><a href="https://stackoverflow.com/questions/2174657/when-are-header-only-libraries-acceptable">When are header-only libraries acceptable?</a></li>
                    <li><a href="https://stackoverflow.com/questions/36560508/how-dynamic-linking-works-its-usage-and-how-and-why-you-would-make-a-dylib">How dynamic linking works, its usage and how and why you would make a <code>dylib</code></a></li>
                    <li><a href="https://stackoverflow.com/questions/480764/linux-error-while-loading-shared-libraries-cannot-open-shared-object-file-no-s">Linux error while loading shared libraries: cannot open shared object file: No such file or directory</a></li>
                    <li><a href="https://stackoverflow.com/questions/34732/how-do-i-list-the-symbols-in-a-so-file">How do I list the symbols in a <code>.so</code> file</a></li>
                    <li><a href="https://stackoverflow.com/questions/311882/what-do-statically-linked-and-dynamically-linked-mean">What do 'statically linked' and 'dynamically linked' mean?</a></li>
                    <li><a href="https://stackoverflow.com/questions/3374767/gcc-linkage-option-l-alternative-ways-how-to-specify-the-path-to-the-dynamic-l" target="_blank"><code>gcc</code> Linkage option <code>-L</code>: Alternative ways how to specify the path to the dynamic library</a></li>
                    <li><a href="https://stackoverflow.com/questions/7214764/static-vs-dynamic-libraries" target="_blank">Static Vs Dynamic libraries</a></li>
                  </ul>
                </div>
              </div>
            </article>
            <article class="post-entry" id="strategy-pattern-lie">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">18/06/2022</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <h2><a href="#strategy-pattern-lie">Strategy pattern lie</a></h2>
                </div>
                <div class="text-shadow">
                  <figure class="side-figure side-figure--right">
                    <img src="https://www.newsanyway.com/wp-content/uploads/2020/04/Canva-Old-Man-Walking-on-Crutches.jpg" alt=""/>
                    <figcaption>A programming language that lacks lambdas, with
                      two of its design patterns (one of them them probably
                      being the strategy pattern).</figcaption>
                  </figure>
                  <p>I'm slowly but inexorably growing the idea that <b>design patterns
                    are, fundamentally, established workarounds to languages' weaknesses</b>.
                  </p>
                  <p>(If you are particularly sensitive, scroll to the bottom of this post, and see
                    how much the strategy pattern can be shrunken in C++.)</p>
                  <p>Indeed,
                  <a href="https://duckduckgo.com/?q=%22design+patterns%22+%2B+weakness+%2B+language&ia=web">if I search the web
                  for <i>"design patterns" + weakness + language</i></a>, I get a lot of results, the first one of
                  which is <a href="https://stackoverflow.com/questions/1579162/are-design-patterns-really-language-weaknesses">a question
                  on StackOverflow</a>, and that question links to <a href="https://blog.plover.com/prog/design-patterns.html">a blog</a>,
                  which I picked the following quote from:
                  </p>
                  <blockquote>
                    <h4>
                      Progress in programming languages
                    </h4>
                    <p>Had the "Design Patterns" movement been popular in 1960,
                    its goal would have been to train programmers to recognize
                    situations in which the "subroutine" pattern was
                    applicable, and to implement it habitually when necessary.
                    [&hellip;], it would have been vastly
                    inferior to what really happened, which was that the
                    "subroutine" pattern was codified and embedded into
                    subsequent languages.</p>

                    <p>[&hellip;]. The problem with the "Design Patterns"
                    movement is [&hellip;] programmers are trained to identify
                    and apply the patterns when possible. Instead, the patterns
                    should be used as signposts to the failures of the
                    programming language. [&hellip;].</p>

                    <p>[&hellip;]. The correct place to implement a common
                    solution to a recurring design problem is in the
                    programming language, if that is possible.</p>

                    <p>The stance of the "Design Patterns" movement seems to be
                    that it is somehow inevitable that programmers will need to
                    implement Visitors, Abstract Factories, Decorators, and
                    Fa√ßades. But these are no more inevitable than the need to
                    implement Subroutine Calls or Object-Oriented Classes in
                    the source language. These patterns should be seen as
                    defects or missing features in Java and C++. The best
                    response to identification of these patterns is to ask what
                    defects in those languages cause the patterns to be
                    necessary, and how the languages might provide better
                    support for solving these kinds of problems.</p>

                    <p>[&hellip;].</p>

                    <p>[&hellip;]. Helping hapless C++ and Java programmers is
                    admirable, but it shouldn't be the end goal. Instead of
                    seeing the use of design patterns as valuable in itself, it
                    should be widely recognized that each design pattern is an
                    expression of the failure of the source language.</p>

                    <p>If the Design Patterns movement had been popular in the
                    1980's, we wouldn't even have C++ or Java; [&hellip;]. But
                    the way to provide as much help as possible was not to
                    train people to habitually implement Object-Oriented
                    Classes when necessary; it was to develop languages like
                    C++ and Java that had this pattern built in, so that
                    programmers could concentrate on using OOP style instead of
                    on implementing it.</p>
                  </blockquote>
                  <p>I read those words and, even if I don't know the author
                  personally, I can't help but agreeing with him, and be
                  astonished when I realize that so many programmers disagree, instead.
                  </p>
                  <figure class="side-figure side-figure--left">
                    <img src="https://picfiles.alphacoders.com/730/73032.jpg" alt="Army of Darkness poster"/>
                    <figcaption>A <i>programmer</i> (aka <i>"user"</i>) with two very powerful <i>programming
                        languages</i> (aka <i>"tools"</i>), and the crowd
                      behind him all use mediocre programming languages,
                      so they don't stand a chance.</figcaption>
                  </figure>
                  <p>The reason for my astonishment is that those words, in my opinion,
                  state something true by definition.
                  Definition of what? Of what the programmer and the
                  programming language are: the user and his/her tool,
                  respectively. Why should they be happy with doing something
                  over and over, when the alternative is that the language
                  does that for them?</p>
                  <p>Nonetheless, many programmers (hugely experienced as well as
                  newbies) strongly disagree with the above view, so praises of
                  design patterns are sung in every corner of the internet.
                  </p>
                  <p>Maybe the only way to convince them of the equation
                  <i>design patterns = weaknesses of a language</i> is to
                  review each single design pattern, and then cook an example
                  written in a programming language that doesn't need that pattern
                  because it's built into the language, or library provides a nice
                  API for it.
                  </p>
                  <p>To do so, I need a reference book, and I chose it to be the famous book
                  <i><a href="https://learning.oreilly.com/library/view/head-first-design/0596007124/cover.html">"Head First - Design Patterns"</a></i>
                  (the one with the blond girl on the cover and many many
                  drawings inside that look like coming from the comics), which is one
                  of the most highly considered books on design patterns, maybe one
                  step below its more earnest counterpart
                  <i><a href="https://books.google.co.uk/books/about/Design_Patterns.html?id=6oHuKQe3TjQC&redir_esc=y">"Design Patterns - Elements of Reusable Object-Oriented Software"</a></i>
                  (at least based on what I've heard in my &hellip; ehm
                  &hellip; 3 years in software development). The reason I chose the former
                  is dual:
                  </p>
                  <ul class="list-beside-float">
                    <li>I don't have the latter;</li>
                    <li>the former is written in a language (Java) other than my main language (C++),
                      so I'm in a better position to show that changing the language
                      can make a big difference on whether you need a pattern or not.</li>
                  </ul>
                  <p>Among all those patters, I'll start from the easy one, The Strategy Pattern.</p>
                  <h3>Review of the "Strategy Pattern"</h3>
                  <p>What is it, and how is it defined?</p>
                  <p>Let's go first to the definition (page 24), which, in all
                  honesty, seems pretty uncontroversial:</p>
                  <blockquote><b>The Strategy Pattern</b> defines a family of
                  algorithms, encapsulates each one, and makes them
                  interchangeable.  Strategy lets the algorithm vary
                  independently from clients that use it.
                  </blockquote>
                  <p>The good thing about it is that it does not refer to
                  objects or to the object-oriented paradigm at all,
                  let alone inheritance and class hierarchies.</p>
                  <p>Nonetheless, there's room for questions already! For instance,</p>
                  <ul>
                    <li>What does it mean for an algorithm to be encapsulated?
                      An algorithm is just a sequence of instructions, and it surely
                      has a beginning and an end, so one can tell where it is. Why do
                      I need to encapsulate it? Who is requiring such a thing?
                      An most importantly: how do I actually encapsulate an
                      algorithm?
                    </li>
                    <li>If two or more algorithms reach the same goal (read
                      <i>"same types of inputs and same type of output"</i>)
                      via different means (read <i>the implementation
                        differs</i>), aren't they interchangeable already?  I
                      can give that very input to each of them, and I'll get
                      the same result every time. That's the definition of
                      interchangeability, no?
                    </li>
                  </ul>
                  <p>And it's upon the answers to those questions, that my
                  point is based, so let's go back to the beginning of the chapter,
                  and find them.</p>
                  <figure class="side-figure side-figure--right">
                    <img src="https://media.giphy.com/media/3oEduZqr2b3f7AG6aI/giphy.gif" alt=""/>
                    <figcaption>A colleague throwing OOP at you.</figcaption>
                  </figure>
                  <p>At page 2, the
                  authors throw the acronym OO at you within the
                  first five lines, before even stating what the problem they want to solve is,
                  so if I had any hope you could find a solution without
                  resorting to OOP, I've already lost it. They've already converted you.
                  I really hope not. Not totally. My point here is: <b>how can you be
                    so confident you'll find the best solution to a problem if you confine
                    your search territory before even analyzing the problem?</b>
                  Can't you see that <b><i>maybe</i> there might be something
                  useful out of the OOP world?</b>
                  </p>
                  <p>But the book is stuck into the religion of OOP, so after a
                  few centimeters down from there, they throw at you
                  inheritance, in the form of a UML diagram. At this point, in
                  an attempt to resist to
                  this dogmatic approach they use, I add another question
                  to the ones above:</p>
                  <ul>
                    <li>Why do we need inheritance? And do we need it at all?</li>
                  </ul>
                  <p>And the <strike>answer to this</strike> intention is probably clear by the time Joe adds
                  the <code>fly()</code> method to the <code>Duck</code> base class:
                  inheritance is used to share a common behavior between all the classes
                  that inherit from a common base class.
                  </p>
                  <pre><code class="language-java">public abstract class Duck {
  public Duck() {}
  public void fly() {
    /* common way of flying */
  }
}</code></pre>
                  <p>The shortcoming of these approach is soon found, because
                  Joe had not anticipated that maybe not <i>all</i> classes
                  inheriting from <code>Duck</code> should be able to
                  <code>fly()</code>.
                  </p>
<pre><code class="language-java">// some ducks are ok with the parent's fly()
public class MallardDuck extends Duck { /* other stuff */ }
// but several might not!
public class RubberDuck extends Duck { /* override fly() to do nothing */ }
public class DecoyDuck extends Duck { /* override fly() to do nothing */ }</code></pre>
                  <p>
                  And here is another question coming up:
                  </p>
                  <ul>
                    <li>Why should I make a class derive from another class, if
                      the former is not happy with one of the methods of the
                      latter?
                    </li>
                  </ul>
                  <p>Joe answers this question, but rather than giving up
                  on inheritance, he does so by moving the <code>fly()</code> method
                  out of the <code>Duck</code> base class into an <code>interface</code>, and
                  making only some of <code>Duck</code>'s derived classes
                  implement the <code>Flyable</code> interface.</p>
                  <pre><code class="language-java">public abstract class Duck {
  public Duck() {}
}
public interface Flyable {
  public void fly();
}
public class RubberDuck extends Duck { /* no fly() whatsoever */ }
public class MallardDuck extends Duck implements Flyable {
  public void fly() {
    /* fly the mallard way */
  }
}</code></pre>
                  <p>This turns out to be a silly choice too, because all
                  Joe's done, with that <code>interface</code>, is sharing <b><i>the need for</i></b>
                  a <code>fly()</code> behavior across the classes that can actually fly,
                  and not <b><i>the</i></b> <code>fly()</code> behavior, so he has
                  to implement that behavior in each and every class that needs it.
                  In other words, the code reuse attempted via inheritance from a base class is
                  thrown away by the attempt of using a common
                  <code>interface</code>. And I've written <code>interface</code> in
                  mono-space, because it is a keyword in Java, where it has a very
                  specific meaning, and that's precisely and admittedly the reason why the attempt
                  fails: <q>Java interfaces have no implementation code, so no code reuse</q>.
                  </p>
                  <p>So let's recap what's wrong with each of the two approaches:</p>
                  <ol>
                    <li>With a <code>Duck</code> base class providing the <code>fly()</code>
                      behavior and all other classes inheriting from it
                      <ul>
                        <li class="good">we have the benefit of sharing that behavior across all
                          derived classes,
                        </li>
                        <li class="bad">and the drawback that we need to manually implement <code>fly()</code>
                          in each and every class that wants to diverge from the common behavior
                        </li>
                      </ul>
                    </li>
                    <li>With a <code>Flyable</code> interface that requires all implementers
                      to implement <code>fly()</code>
                      <ul>
                        <li class="good">We have the benefit that not all <code>Duck</code>'s
                          derived classes have a <code>fly()</code> method, but each of them
                          can independently decide to implement <code>Flyable</code> only if
                          they want to,
                        </li>
                        <li class="bad">and the drawback that we must repeat the
                          code of <code>fly()</code> for all the classes that want it,
                          <b><i>even if they want the same flavour of <code>fly()</code>ing</i></b>,
                          because, as mentioned, Java interfaces have no implementation code.
                        </li>
                      </ul>
                    </li>
                  </ol>
                  <p>Do you see anything? I hope that you've noticed how the
                  two approaches are complementary to each other, as they have
                  opposite advantages and opposite drawbacks. Therefore you
                  might agree that a couple of additional questions come up naturally:
                  </p> <ul>
                    <li>Can't I just have multiple <b>base classes</b>, instead of multiple
                      interfaces? E.g. <code>FlyableLikeBird</code>,
                      <code>FlyableLikeRocket</code>, <code>FlyableNoWay</code>, and so on,
                      each with its default implementation of <code>fly()</code>, and every other class
                      derive from the flavour they want? Doing so, I could take the
                      first approach without the drawback.
                    </li>
                    <li>What if my language allows the implementation of methods in an interface?
                      If that's allowed, then I'd be removing the drawback from the second approach,
                      making it winning.
                    </li>
                  </ul>
                  <p>
                  It turns out that these two questions are actually the same
                  question looked at from two different angles, because
                  if interfaces were allowed to have implementations, they'd be
                  base classes, and so we'd be just trying to inherit from
                  multiple base classes, and point is that multiple inheritance
                  is not allowed in Java.
                  </p>
                  <p>On the other hand, both these things (inheriting from multiple base classes
                  and implementing interface methods) are a thing in C++, which makes me
                  hope that, at this point, the doubt about the real value
                  of the Strategy Pattern should be crawling in your mind. At least, you might be thinking,
                  the path from the problem to the solution is shorter in C++ than in Java,
                  for the simple reason that C++ has a feature that Java lacks. By simple extension,
                  you might agree that the added value of the strategy pattern depends on the
                  language you are using.
                  </p>
                  <p>Now let's jump to the proposed solution at page 22, which makes, at least in part,
                  use of composition instead of inheritance:</p>
                  <ul>
                    <li>create an <code>interface</code> for each of the behavior that you want to vary at will
                    across the objects deriving from <code>Duck</code>, e.g. <code>FlyBehavior</code>
                    and <code>QuackBehavior</code>;
                    </li>
                    <li>every time you need a new flavour of a behavior create a class implementing
                    the appropriate <code>interface</code>, e.g. <code>FlyWithWings</code> would implement
                    <code>FlyBehavior</code> thus providing one flavour of <code>fly()</code>ing;
                    </li>
                    <li>add two one member for each of the behaviors into the <code>Duck</code>
                      base class, e.g. <code>Duck</code> would have members <code>FlyBehavior flyBehavior</code>
                      and <code>QuackBehavior quackBehavior</code>.
                    </li>
                    <li>Whenever you need a new type of duck, create a class inheriting
                      from <code>Duck</code> and assigning appropriate values to <code>flyBehavior</code>
                      and <code>quackBehavior</code>, those values being objects of class
                      one of the implementers of the appropriate method, e.g. <code>RubberDuck</code>
                      would inherit from <code>Duck</code> and assign <code>flyBehavior</code>
                      the value of <code>new FlyNoWay()</code>, and something else to the other method.
                    </li>
                  </ul>
                  <div class="some-grid">
                  <pre><code class="language-java">public abstract class Duck {
  public Duck() {}
  // methods that derived classes can inject
  FlyBehavior flyBehavior;
  QuackBehavior quackBehavior;
  public void doFly() {
    flyBehavior.fly();
  }
  public void doQuack() {
    quackBehavior.quack();
  }
  // methods that every derived must implement
  public abstract void display();
  // methods that none must implement
  public void swim() {
    /* impl common to all ducks */
  }
}</code></pre>
<pre><code class="language-java">public interface FlyBehavior {
  public void fly();
}
public interface QuackBehavior {
  public void quack();
}

public class FlyWithWings implements FlyBehavior {
  public void fly() { /* impl */ }
}
public class FlyNoWay implements FlyBehavior {
  public void fly() { /* impl */ }
}</code></pre>
<pre><code class="language-java">public class MallardDuck extends Duck {
  public MallardDuck() {
    flyBehavior = new FlyWithWings();
    quackBehavior = new Quack();
  }
  public void display() {
    /* impl */
  }
}</code></pre>
                  </div>

                  <h3>Trying to slim down the pattern</h3>

                  <p>But now look carefully at what <code>Duck</code> is: it is fundamentally
                  a collection of methods, or behaviors, of which
                  </p>
                  <ul>
                    <li>
                      two, <code>doFly()</code> and <code>doQuack()</code>, are
                      expected to be injected by the derived classes via
                      assignment of the members <code>flyBehavior</code> and
                      <code>quackBehavior</code> respectively;
                    </li>
                    <li>
                      another one, <code>display()</code>, is expected to be implemented by every one of
                      the derived classes;
                    </li>
                    <li>and the last one, <code>swim()</code>, is expected to be the same across
                      all derived classes.
                    </li>
                  </ul>
                  <p>It should be fairly clear that <code>display()</code> is not fundamentally
                    different from <code>doFly()</code> and <code>doQuack()</code>: the fact
                    that it is implemented differently across each derived class, and that
                    instead several different classes might inject the same concrete behavior into
                    <code>doFly()</code>, is purely incidental. Therefore, <code>display()</code> too
                    can be factored out as the other two, and each derived <code>Duck</code>
                    will inject its concrete implementation of it.
                  </p>
                  <p>On the other hand, <code>swim()</code>, since it's meant to be common
                  to all <code>Duck</code>s, is not exactly like the other three behaviors,
                  but also not that different: we can also implement it as a call to a member,
                  just being careful to initialize it in <code>Duck</code>'s constructor,
                  and making it <code>private</code> or <code>final</code>, so that it will
                  stay the same across all <code>Duck</code>s no matter what.
                  </p>

                  <p>Now, in view of the above, we can rewrite the <code>Duck</code> class like this:
                  </p>
                  <pre><code class="language-java">public abstract class Duck {
  final SwimBehavior swimBehavior;
  public Duck() { swimBehavior = SwimNormally(); }
  // methods that derived classes can/must inject
  DisplayBehavior displayBehavior;
  FlyBehavior flyBehavior;
  QuackBehavior quackBehavior;
  public void doDisplay() {
    displayBehavior.display();
  }
  public void doFly() {
    flyBehavior.fly();
  }
  public void doQuack() {
    quackBehavior.quack();
  }
  public void doSwim() {
    swimBehavior.swim();
  }
}</code></pre>
<pre><code class="language-java">public class MallardDuck extends Duck {
  public MallardDuck() {
    flyBehavior = new FlyWithWings();
    quackBehavior = new Quack();
    displayBehavior = new MallardDuckDisplay();
  }
}</code></pre>
<pre><code class="language-java">public class MallardDuck extends Duck {
  public RubberDuck() {
    flyBehavior = new FlyNoWay();
    quackBehavior = new Squeak();
    displayBehavior = new RubberDuckDisplay();
  }
}</code></pre>
                  <p>But now what's left of <code>Duck</code>? Just a shell, a container,
                  a box, in which 3 methods can be injected from outside and 1 is fixed.</p>
                  <p>And what's left of the derived classes, such as <code>MallardDuck</code>
                  or <code>RubberDuck</code>? They only take care of selecting a flavour for
                  each of the behaviors, so why having those classes at all? We could just
                  as well provide <code>Duck</code> with methods to set its behaviors (maybe
                  the constructor, maybe actual setters), and then spawn objects of class
                  <code>Duck</code>, which are all interchangeable because have the same
                  class, and yet are different because we've injected different behaviors
                  in them. You'd then have call sites like this (assuming the behaviors
                  are set via <code>Duck</code>'s constructor, appropriately rewritten):
                  </p>
<pre><code class="language-java">Duck mallard = new Duck(MallardDuckDisplay(), FlyWithWings(), Quack());</code></pre>
                  <p>See? No need for inheritance, so we have an answer to one of the questions.</p>
                  <p>In fact, we can also answer another question, the <i>"why
                    do I need (in Java) to encapsulate the algorithms and how
                    do I do it?"</i> The answer is that the algorithms
                    (functions, e.g. <code>.fly()</code>) are encapsulated by wrapping them in a classes
                    (e.g. <code>FlyBehavior</code>), and
                    the advantage of doing so is that we can assign, change, swap, delete,
                    ‚Ä¶, the algorithms by assigning, changing, swapping,
                    deleting, ‚Ä¶ objects of that class (e.g.
                    <code>flyBehavior</code>) at run time.
                  </p>
                  <p>So the classes wrapping/encapsulating the algorithm, only serve
                  the purpose of dealing with the algorithms as they were objects.</p>
                  <p>But the story is not over in Java: now that algorithms are wrapped
                  in objects, we can't call them anymore, i.e. we can't just do the following</p>
<pre><code class="language-java">Duck duck = new MallardDuck();
duck.fly();         // Duck has no fly() method!
                    // Yeah, it does have a flyBehavior,
duck.flyBehavior(); // but we can't call it either!</code></pre>
                  <p>Instead, we have to go via a chain</p>
<pre><code class="language-java">duck.flyBehavior.fly();</code></pre>
                  <p>which is precisely the reason why we've put <code>doFly()</code> in place:</p>
<pre><code class="language-java">duck.doFly(); // equivalent to the above</code></pre>
                  <p>So it should be clear that the four members <code>displayBehavior</code>,
                  <code>flyBehavior</code>, <code>quackBehavior</code>, and <code>swimBehavior</code>
                  precisely mirror the four member functions <code>doDisplay()</code>,
                  <code>doFly()</code>, <code>doQuack()</code>, and <code>doSwim()</code>, and
                  that the latter only exist to ease the syntax you need to call the methods
                  wrapped in the former.
                  </p>

                  <h3>Turning point: pick another language</h3>

                  <p>This is the point that, in my opinion, should motivate one to look
                  for another language.
                  </p>
                  <p>For instance, in C++, you have operator overloading, and one operator that you
                  can overload is <code>operator()</code>, which enables you to make
                  the syntax <code>duck.flyBehavior()</code> valid in C++, by simply
                  renaming <code>FlyBehavior</code>'s <code>fly</code> method
                  <code>operator()</code> (at this point it makes sense to change
                  the name of the object of <code>FlyBehavior</code> class from
                  <code>flyBehavior</code> to <code>fly</code>, so the syntax actually looks
                  like <code>duck.fly()</code>):
                  </p>
                  <a href="https://godbolt.org/z/xxqr6jfTW" target="_blank">
                    <pre><code class="language-cpp">struct FlyBehavior {
  virtual void operator()() const = 0;
};
struct FlyWithWings : public FlyBehavior {
  virtual void operator()() const {
    /* impl */
  }
};

struct Duck {
    FlyBehavior const& fly;
    /* ‚Ä¶ */
};

int main() {
    auto rubberDuck = Duck{FlyNoWay{}};
    auto mallardDuck = Duck{FlyWithWings{}};
    rubberDuck.fly();
    mallardDuck.fly();
}</code></pre>
                  </a>
                  <p>The example above, however, is still not as flexible as the one presented in Java:
                  for the syntax <code>duck.fly()</code> to be possible, I couldn't make the
                  member <code>fly</code> a pointer (i.e., to be
                  modern, by wrapping it into a <code>std::unique_ptr</code>), otherwise the syntax
                  would be as ugly as <code>rubberDuck.fly-&gt;operator()()</code>, but at the same
                  time I couldn't make it a value member (i.e. <code>FlyBehavior fly;</code>) because
                  <code>FlyBehavior</code> is an abstract class, as it's got a pure virtual
                  member function (i.e. one marked <code>virtual</code> and ending with <code>= 0;</code>),
                  so an object of that class can't be instantiated; I had to make it <code>const&amp;</code>
                  (a non-<code>const</code> reference would not be possible either, because it wouldn't
                  allow passing temporaries to <code>Duck</code>'s constructor, as in <code>Duck{FlyNoWay{}}</code>).
                  </p>

                  <p>To me, this is a symptom that we are still victim of the language; or, better,
                  we are victim of our bad choice of what features we use to model a certain thing.
                  Indeed, even though we gave up on inheritance in favour of composition on the "duck side"
                  of the things, we are still using inheritance on the "behavior" side of it.</p>

                  <p>So let's try to get rid of inheritance here too. Again, the inheritance was brought in
                  as a tool to share a common behavior between all the classes that inherit from a common
                  class. But behaviors are just functions, and, in the context of the strategy pattern,
                  behaviors have nothing to do with what the (member or not)
                  functions actually do internally with their implementations, but with how they can be called,
                  which is determined solely by they signatures.</p>

                  <p>This, incidentally, answers another question: yes, for two or more algorithms to
                  be interchangeable, they just need to be callable in the same way, i.e. they have
                  to share the signature. And this has nothing to do with inheritance. Sure, if we
                  confine ourselves to Java, maybe the only way for two functions to share the same
                  call syntax is that they are member functions of classes implementing a common
                  <code>interface</code> (is that the case?), but what if we change language?</p>

                  <p>Indeed, if all we have to do is plugging one of several functions, which all share
                  the same signature, in a slot of our <code>Duck</code> class, then C++ does offer
                  a tool, <code>std::function</code>, which need not be <code>const</code>
                  (fundamentally a <code>std::function</code> can have a "disengaged" state, unlike
                  a member of an abstract base class, which has to point to a concrete class and, as such,
                  can't be other than a pointer/reference). Since it's not <code>const</code> its
                  target can be changed at run time, giving the same flexibility as the Java
                  solution, but with a much slimmer code.
                  </p>

                  <p>A bonus advantage of using <code>std::function</code> to store behaviors
                  is that we can throw at it also any lambda, making it easy to assign
                  behavior at run time, with no need for any behavior class at all.</p>

                  <p>Below is a working example</p>
                  <a href="https://godbolt.org/z/4E8rY5TKM" target="_blank">
                    <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;functional&gt;

constexpr auto flyWithWings = []{
    std::cout &lt;&lt; "flyWithWings" &lt;&lt; std::endl;
};

constexpr auto flyNoWay = []{
    std::cout &lt;&lt; "flyNoWay" &lt;&lt; std::endl;
};

constexpr auto swimBehavior = []{
    std::cout &lt;&lt; "we all swim the same" &lt;&lt; std::endl;
};

struct Duck {
    std::function&lt;void()&gt; fly;
    std::function&lt;void()&gt; quack;
    std::function&lt;void()&gt; const swim; // const, to make it the same across all ducks
};

int main() {
    auto rubberDuck = Duck{
        flyNoWay,
        []{ std::cout &lt;&lt; "squeak" &lt;&lt; std::endl; },
        swimBehavior
    };
    auto mallardDuck = Duck{
        flyWithWings,
        []{ std::cout &lt;&lt; "quack" &lt;&lt; std::endl; },
        swimBehavior
    };

    rubberDuck.fly();
    mallardDuck.fly();
    // cut off their limbs (cf. Dead Space)
    mallardDuck.fly = []{ std::cout &lt;&lt; "they cut my wings!" &lt;&lt; std::endl; };
    mallardDuck.fly();
    //mallardDuck.swim = []{}; can't change it, ok.
}</code></pre>
                  </a>
                  <p>A note about the use of <code>std::function</code>: I'm not advocating
                  it, in general, because I'm convinced (by questions, answers, other blog's
                  posts, and stuff that I've read) that it has important drawbacks (only performance-wise?).
                  However, at least in C++, if you want a member (or even a non-member) variable
                  to be able to store one lambda now, and a different lambda later, you do
                  need type erasure, because the lambdas have all different types (even
                  if you write the same lambda expression twice, you get two different types,
                  a.k.a. <code class="language-cpp">static_assert(std::is_same_v&lt;decltype([]{}), decltype([]{})&gt;)</code> fails!),
                  and <a href="https://stackoverflow.com/questions/14936539/how-stdfunction-works">type erasure is a technique that <code>std::function</code> makes use of</a>,
                  and it's also the reason (one of several?) why it's not to be used with levity.
                  Now whether you go wild and simply use <code>void*</code> or let other abstractions
                  like <code>std::function</code> take care of type erasure, type erasure is there.
                  </p>

                  <h3>Conclusions</h3>

                  <p>What I wanted to show with the above review, analysis, and alternative solution,
                  is the following:</p>
                  <ul>
                    <li>The so-called "Strategy Pattern" is often implemented
                      using <b>inheritance</b> (in the broad sense of <b>implementing an
                        interface or extending a class</b>);</li>
                    <ul>
                      <li>the tool of <b>inheritance</b> (properly said in Java) is used <b>to share common behavior</b> between
                        different <b><i>classes</i></b>: different ducks are objects instantiated for
                        different <b><i>classes</i></b>, and they all have slots to plug in behaviors;</li>
                      <li>the tool of implementing an interface is used to force different <b><i>classes</i></b>
                        to provide an implementation of one specific behavior;</li>
                      <li>In some way, inheritance (via <code>implements</code> or <code>extends</code>) is used to distribute
                        different functions (e.g. the <code>.fly()</code> and <code>.quack()</code> member functions)
                        or different objects (e.g. the <code>flyBehavior</code> and <code>quackBehavior</code> members)
                        across distinct classes (<code>Duck</code>'s derived classes and behavior's implementers respectively).</li>
                    </ul>
                    <li>Another approach is the one I propose, where we abandon inheritance, and only rely
                    on composition and the language tools (whether those use internally inheritance, it's not
                    our concern, because that stuff would be hidden under a useful abstraction that
                    we need not reimplement from scratch). With this approach</li>
                    <ul>
                      <li>different ducks are just different <b><i>objects</i></b> instantiated
                        from a common class, and they have slots to plug behavior;</li>
                      <li>the tool of <code>std::function</code> is used to force different function <b><i>objects</i></b>
                        to be callable the same way.</li>
                      <li>In some way, composition and <code>std::function</code> are used to distribute
                      different functions across different <b><i>objects</i></b>.</li>
                    </ul>
                  </ul>
                  <p>And inheritance hierarchies are notoriously a hard thing to get right. Why not
                  abandoning it entirely in favour of language features that give us already baked
                  abstractions?</p>

                  <p>Most importantly, and this is truly the conclusion, if you go back to the
                  previous snippet of code, and hopefully agree that the whole
                  "Strategy Pattern" is contained in these 5 lines,</p>
                    <pre><code class="language-cpp">struct Duck {
    std::function&lt;void()&gt; fly;
    std::function&lt;void()&gt; quack;
    std::function&lt;void()&gt; const swim;
};</code></pre>
                  <p>would you say it deserved an extravagant name and a whole chapter of even just one book?</p>
                  <h3>Bonus</h3>
                  <p>The solution looks pretty much the same in the purely
                  functional programming language Haskell, where the strategy
                  pattern is enabled by the presence of <a href="http://blog.ezyang.com/2010/05/design-patterns-in-haskel/"><q>first class functions
                      and lambdas</q></a> (words of <a href="http://ezyang.com/">a research engineer at Facebook</a>)
                  </p>
                    <pre><code class="language-haskell">data Duck = Duck {
  fly :: IO (),
  quack :: IO (),
  display :: IO ()
}</code></pre>
                  <p>Without going too much into detail,
                  </p>
                  <ul>
                    <li><code>IO ()</code> has fundamentally the same role as <code>void()</code>;</li>
                    <li>Haskell's datatype are immutable, so you can't truly <i>change</i> the
                    behaviors stored in <code>mallard</code>;</li>
                    <li>but you can indeed create a new <code>mallard'</code> from <code>mallard</code>
                      picking only some of the latter's behaviors and setting new values; that's done
                      via pattern matching, but to limit the ability to pattern match, for instance to
                      prevent one from creating a <code>mallard'</code> with a <code>display</code>
                      other than <code>mallard</code>'s, you can put <code>Duck</code> in a module,
                      and expose only the interface that you want to expose:
                      <a href="https://onlinegdb.com/w3cWJ6ssE" target="_blank">
                        <pre><code class="language-haskell">-- Duck.hs
module Duck (makeDuck, fly, quack, display, setFly, setQuack) where

data Duck = Duck {
  fly :: IO (),
  quack :: IO (),
  display :: IO ()
}

-- Duck, the ctor is not expeorted, otherwise client code could
-- pattern match on a Duck internals; instead, we expose a make
-- function equivalent to it
makeDuck :: IO () -&gt; IO () -&gt; IO () -&gt; Duck
makeDuck = Duck

setFly f' (Duck f q d) = Duck f' q d
setQuack f' (Duck f q d) = Duck f' q d
-- but not setDisplay

-- usage in another_file.hs
import Duck
mallard = makeDuck (print "(normal flying)") (print "quack") (print "I'm a mallard duck")

fly mallard      -- prints "(normal flying)"
quack mallard    -- prints "quack"
display mallard  -- prints "I'm a mallard duck"

mallard' = setFly (print "they cut my limbs!") mallard
fly mallard'     -- prints "they cut my limbs!"</code></pre>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </article>
            <article class="post-entry" id="trimmed-string-equality--and--big-o-complexity">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">24/04/2022</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/c++-logo.png" alt="">
                  <h2><a href="#trimmed-string-equality--and--big-o-complexity">Big-O complexity is not all you need</a></h2>
                </div>
                <div class="text-shadow">
                  <p>This article is about the time I discovered, the hard way, that
                  there's much more than big-O complexity in performance analysis:
                  even if two algorithms have the same big-O complexity, the difference
                  in how they perform can be tremendous, because of the literally <b>huge</b>
                  multiplicative constant that can exist between them, as a consequence of
                  hardware optimizations.
                  </p>
                  <h4>A simple problem &mdash; string equality</h4>
                  <p>One of the simplest expressions that sooner or later all
                  programmers write is
                  </p>
                  <pre><code>str == "some string"</code></pre>
                  <p>and sometimes we don't even care much about the time
                  complexity of such a comparison.
                  </p>
                  <p>For instance, if this comparison is done in the context of
                  command line parsing to recognize whether the user has
                  selected an option, so whatever the complexity of that comparison is,
                  we'll pay for it only once, or at least a small known number of times.
                  </p>
                  <h4>String equality &mdash; many times</h4>
                  <p>However there are times when this comparison is run for all elements
                  of a possibly long collection of strings</p>
                  <a href="https://godbolt.org/z/nW43vWY5P">
                    <pre><code class="language-cpp">auto validStrings = strings | filter(not_fn(equals("&lt;invalid&gt;"s)));</code></pre>
                  </a>
                  <p>If <code>strings</code> contains <i>N</i> strings, we'll
                  pay the cost of string comparison <i>N</i> times, so we do
                  want to know how much that cost is. And if we make those comparisons
                  inside an algorithm which is not linear in the number of strings like
                  <code>filter</code>, but, say, quadratic, then knowing the
                  cost of the individual comparisons is even more
                  important.</p>
                  <p>So, how much is the time complexity of string comparison?</p>
                  <p><q>Well</q>, I told myself, <q>the best case scenario is when the strings
                  have different length, in which case the algorithm can return in constant time</q>.</p>
                  <p>And then <q>if their length is equal, then all characters have to be compared
                  one by one for as long as it takes to find a character that is different between the
                  two strings</q></p>

                  <h4>Rushed conclusions</h4>
                  <p>In summary, my conclusion was that</p>
                  <ul>
                    <li>
                      <code>"hello"</code> and <code>"hello world"</code> are
                      compared in constant time because their lengths are
                      different. (This is the best case scenario.)
                    </li>
                    <li>
                      <code>"hello"</code> and <code>"hello"</code> are
                      compared in linear time, and since they <i>are</i> equal,
                      it takes 6 comparisons to conclude that they are indeed
                      equal, because 1 comparison is to check their lengths are equal
                      and 5 is the number of characters that we need to compare.
                      (This is the worst case scenario.)
                    </li>
                    <li><code>"hello"</code> and <code>"help!"</code> are also compared
                      in linear time, but it takes just 5 comparisons to conclude so,
                      because we can bale out as soon as the second <code>'l'</code> in
                      <code>"hello"</code> compares different from the <code>'p'</code>
                      in <code>"help!"</code>. (This is an average scenario.)
                    </li>
                  </ul>
                  <h4>A more complex problem &mdash; whitespace-trimmed string equality</h4>
                  <p>Fast forward a few months, and I had to consider that, in
                  the dummy example described above, the invalid strings could
                  contain some leading and trailing whitespace, e.g. an
                  invalid string could be <code>"‚ê£‚ê£‚ê£&lt;invalid&gt;‚ê£‚ê£"</code>,
                  where I've used the <code>‚ê£</code> symbol to mean a
                  whitespace.</p>
                  <p>Forgetful of my conclusions above, with confidence I changed the code to
                  something like this</p>
                  <a href="https://godbolt.org/z/Mj8d1c7j3">
                    <pre><code class="language-cpp">auto validStrings = strings | filter(compose(not_fn(equals("&lt;invalid&gt;"s)), trim(isSpace)));</code></pre>
                  </a>
                  <p>where <code class="language-cpp">compose(f, g)</code> is a
                  function that first runs <code>trim(isSpace)</code> on its
                  input to remove any leading and trailing whitespace, and then
                  runs <code>not_fn(equals("&lt;invalid&gt;"))</code> on the
                  result.
                  </p>
                  <p>In fact, the above code is still more complex than it needs;
                  indeed I forgot that <code>ranges::views::filter</code> accepts
                  a second argument that projects each element of the range
                  before passing it to the filtering predicate, so the above
                  can be streamlined into this:</p>
                  <a href="https://godbolt.org/z/dsqTKnE8r">
                    <pre><code class="language-cpp">auto validStrings = strings | filter(not_fn(equals("&lt;invalid&gt;"s)), trim(isSpace));</code></pre>
                  </a>
                  <p>It's neat, isn't it?</p>
                  <p>And what about the complexity? <q>Well</q>, I thought, <q>the trimming
                    is a linear operation too, just like checking strings for
                    equality, as all it does is comparing the leading characters one by
                    one with the space character, increasing a counter at the same time; when
                    the first non-space is met, the counter is basically the offset
                    from which the string needs to be compared with <code>"&lt;invalid&gt;"</code>
                  </q> (the same holds, modulo a slightly different wording, for trailing whitespace).
                  </p>

                  <h4>The whitespace-trimmed equality comparison is much slower!</h4>
                  <p>It turned out that the code above performed poorly with respect to the original one,
                  and I initially had no idea why, because based on my analysis both functions passed
                  to <code>filter</code> should run in linear time with the length of the string they are
                  passed.
                  </p>

                  <h4>Here's why</h4>
                  <p>Stepping through the code with the debugger is what
                  eventually helped me figure out what my mistake was:
                  </p>
                  <ul>
                    <li>
                      when comparing <code>"‚ê£‚ê£‚ê£hello‚ê£‚ê£"</code> with itself via
                      <code class="language-cpp">std::equal_to&lt;&gt;{}</code>,
                      a.k.a. the plain <code class="language-cpp">==</code>
                      operator, the function
                      <a href="https://en.cppreference.com/w/c/string/byte/memcmp"><code class="language-cpp">__builtin_memcmp</code></a>
                      is called once to compare the two strings, and the function
                      <a href="https://en.cppreference.com/w/c/string/byte/memchr"><code class="language-cpp">__builtin_memchr</code></a>
                      is never called.
                    </li>
                    <li>
                      when comparing <code>"‚ê£‚ê£‚ê£hello‚ê£‚ê£"</code> with itself via
                      <code class="language-cpp">equal ^on^ trim(isSpace)</code>,
                      a.k.a. the plain <code class="language-cpp">==</code>
                      operator called on the whitespace-trimmed strings, the function
                      <a href="https://en.cppreference.com/w/c/string/byte/memchr"><code class="language-cpp">__builtin_memchr</code></a>
                      is called 7 times! Once for each space that is trimmed,
                      plus once for the <code class="language-cpp">'h'</code>
                      and once for <code class="language-cpp">'o'</code>(i.e.
                      the first and last non-space characters); only after all
                      these calls, does the compiler run a string comparison
                      between what's left, the two <code>"hello"</code>
                      substrings, with pretty much the same efficiency as the previous point.
                    </li>
                  </ul>
                  <p>So it is evident that the trimming part of the algorithm is what really costs, for the reason that it requires
                  the processor to truly process the trimmed characters one at a time.</p>

                  <p>Fundamentally, what's
                  wrong in the conclusion I had initially drawn is that I
                  didn't consider at all that in the non-best case scenario,
                  e.g. when comparing two equally long strings for equality,
                  the comparisons between corresponding characters need not be
                  run in any specific order; actually, they can be run at the
                  same time. If the hardware is capable of comparing those 5
                  characters at the same time, it'll do, thus dividing the cost
                  of the comparison roughly by 5.
                  </p>

                  <p>On the contrary, trimming is an operation inherently
                  directional, because you want to find <i>the first
                  character</i> which is not equal to the characters you're
                  discarding, so you must walk the characters from the first onward,
                  and ask for each single one of them <q>should I discard it?</q>.</p>

                  <h4>Conclusions</h4>
                  <p>I've learned that Big-O complexity is maybe where one has to start
                  to assess whether an algorithm is good and how much, but it is certainly
                  not where one should stop.</p>
                  <p>As regards the fact that a processor can make, fundamentally, string
                  equality in (what to me looks like) constant time, I don't know much about it,
                  probably because I lack an academic background about this stuff (I'm
                  an aerospace engineer).
                  </p>
                  <p>For this reason, I decided to ask a question on
                  <a href="https://cs.stackexchange.com/questions/150755/complexity-of-string-comparison-vs-whitespace-trimmed-string-comparison">cs.stackexchange</a>;
                  at the time I'm writing this post it's only been commented, not answered, but the comments mention
                  a CPU implementation detail called <a href="https://en.wikipedia.org/wiki/Superscalar_processor">"superscalarity"</a>.
                  </p>
                </div>
              </div>
            </article>
            <article class="post-entry" id="bitten-by-sso">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">06/12/2021</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/c++-logo.png" alt="">
                  <h2><a href="#bitten-by-sso"><span lang="en">Bitten by</span><span lang="it">Scottato dalla</span> SSO</a></h2>
                </div>
                <div class="text-shadow">
                  <p>I was working on a text processing tool that
                  accepts text in a form as simple as
                  <pre><code class="language-cpp">std::string input{"this is the text the algorithm is fed with"};</code></pre>
                  and does simple stuff like filtering and transforming text (e.g.
                  removing vocals, converting tabs to spaces, &hellip;,
                  whatever comes to mind), eventually showing the string in some
                  GUI with colored overlays based on the outcome of those text
                  operations.
                  </p>

                  <p>Instead of performing these operations eagerly, by dealing with
                  actual <code class=language-cpp">std::string</code>s (which
                  would mean that potentially a lot of
                  <code class=language-cpp">std::string</code>
                  are constructed, copied, and moved around), the algorithm
                  works with views, and returns a collection of views on the input string,
                  without actually instantiating, copying, or moving
                  any <code class=language-cpp">std::string</code>.
                  Making the simplifying assumption that the algorithm truly returns
                  one single <code class="language-cpp">std::string_view</code>, the code
                  could look like this
                  <pre><code class="language-cpp">std::string_view algo(std::string const&amp; s) {
    // very complex algorithm: chops off first and last characters
    return std::string_view(s.c_str() + 1, s.size() - 1);
}</code></pre>
                  and be used like this
                  <pre><code class="language-cpp">auto out = algo(input);</code></pre>
                  </p>

                  Now, in the application I was working on, the
                    <code>out</code> object played the role of the <i>model</i>
                    in the <a href="https://it.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel">MVVM pattern</a>,
                    and it was not directly used in the GUI.
                  </p>

                  <p>What was used in the GUI were two things:
                  </p>
                  <ul>
                    <li>the actual text contained in <code>input</code>
                      in order to&hellip; well, show the text on screen,</li>
                    <li>and the <a href="https://it.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel"><i>viewmodel</i></a>
                      which, in practice, just consisted of <code>out.length()</code>.
                    </li>
                  </ul>
                  <p>
                  And how were these two things made available to the front end? By wrapping them both
                  in a class like this
                  </p>
                  <pre><code class="language-cpp">struct TextAndViewmodel {
    std::string s;
    int vm;
    TextAndViewmodel(std::string&amp;&amp; s, int vm)
        : s{std::move(s)}, vm{vm}
    {}
};</code></pre>
                  <p>
                  and that's were a silent bug was waiting for me! Can you spot it?
                  </p>

                  <p>The bug is in that <code>TextAndViewmodel</code> holds the
                  text by value (rather than via a <code>std::unique_ptr</code>
                  or some other owning wrapper with pointer or reference
                  semantics).</p>

                  <p>Because of that, when such an object was initialized, for instance
                  via
                  <pre><code class="language-cpp">TextAndViewmodel tv{std::move(input), out.length()};</code></pre>
                  the <code>input</code> was moved from under the
                  <code>std::string_view</code> returned by the algorithm
                  (<code>out</code>), which end up
                  being dangling.
                  </p>

                  <p>To be precise, this was not yet a bug: the <code>std::string</code>
                  underlying <code>out</code> was gone forever, but <code>out.length()</code>
                  was not affected, so the <code>TextAndViewmodel</code> object was just fine.
                  </p>

                  <p>It became a bug as soon as, for other reasons, I had to include
                  <code>out</code> itself into <code>tv</code>,
                  and make use of it to decide whether <code>vm</code> should be used or not
                  for each of the <code>TextAndViewmodel</code> objects (it was
                  a kind of a last-minute filtering right before sending stuff to
                  the GUI).
                  </p>
                  <pre><code class="language-cpp">struct TextAndViewmodel {
    std::string s;
    std::string_view sv;
    TextAndViewmodel(std::string&amp;&amp; s, std::string_view vm)
        : s{std::move(s)}, sv{sv}
    {}
    // if the client needs what was `vm` in the
    // previous snippet, they can go for `sv.length()`
};</code></pre>
                  <p>
                  At that point, indeed, I started noticing some
                  weird things going on in the GUI:
                  </p>
                  <ul>
                    <li>the text was ok, because <code>input</code> was moved into <code>tv</code>,</li>
                    <li>and for "normally sized" text files everything was fine in all respects,</li>
                    <li>but whenever I tried with a few characters long files, the GUI
                      behaved as the filtering I mentioned above never happened, even if it should.</li>
                  </ul>

                  <p>After spending some time (I really can't unveil how much) debugging and banging my
                  head on the monitor, I understood what was going on: <a
                                                                           href="https://stackoverflow.com/questions/10315041/meaning-of-acronym-sso-in-the-context-of-stdstring">SSO</a>
                  was biting me. Actually, the other way around: SSO is the only reason why I could see
                  the bug, otherwise it could have lingered there, silent for a long while, waiting for
                  somebody other than me, maybe a customer, to bite.</p>

                  <p>So what was going on?</p>

                  <p>When <code>input</code> was long enough and
                  SSO wasn't kicking in, the <code>char
                    const*</code> inside it was left intact, as the "movement"
                  of resources simply consisted in the pointer held by
                  <code>input</code> was copied into the one held by
                  <code>tv.s</code>, and then set to <code>nullptr</code>
                  (yes, <a
                    href="https://stackoverflow.com/questions/3413470/what-is-stdmove-and-when-should-it-be-used"><code>std::move</code>
                    doesn't move anything</a>).
                  </p>
                  <p>The consequence is that <code>out</code> was "legally"
                  invalid, because <code>input</code> was
                  <code>std::move</code>d from under it, but "romantically"
                  (aka SSO not kicking in) still looking onto the correct area
                  of memory.
                  </p>

                  <p>On the other hand, when SSO kicked in, then the actual <code>char</code>s
                  stored in the "special short-string compartment" in
                  <code>input</code> were truly copied, one by one, into the corresponding
                  member of <code>tv.s</code>, and then freed, which for me resulted in
                  <code>input</code> being left full of garbage <code>char</code>acters and,
                  in turn, the filtering I mentioned not happening at all.
                  </p>

                  <p>In the process of debugging, I wrote this little code to print
                  the string length for which the SSO is disabled (which is an implementation
                  detail, by the way):
                  <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;

int main()
{
    std::string str1{""};
    bool sso{true};
    while (sso) {
        str1 += "x";
        char const* ptr = str1.c_str();
        std::string str2{std::move(str1)};
        sso = (void*)ptr != (void*)str2.c_str();
        std::cout &lt;&lt; (void*)ptr &lt;&lt; std::endl;
        std::cout &lt;&lt; (void*)str2.c_str() &lt;&lt; std::endl;
        str1 = str2;
    }
    std::cout &lt;&lt; str1.length() &lt;&lt; std::endl;
}</code></pre>
                  </p>
                </div>
              </div>
            </article>
            <article class="post-entry" id="emcpp-item26">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">20/11/2021</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/c++-logo.png" alt="">
                  <h2><a href="#emcpp-item26">The importance of <i>Item 26</i> from <i>Effective Modern C++</i></a></h2>
                </div>
                <div class="text-shadow">
                  <h5>Foreword</h5>
                  <p>Some time ago I tried to <a
                    href="https://stackoverflow.com/questions/218025/what-is-the-difference-between-currying-and-partial-application">partially
                    apply</a> <a
                  href="https://en.cppreference.com/w/cpp/utility/variant/visit"><code>std::visit</code></a>
                  to a visitor, the reason being that I had to visit several <code>std::variant</code>s with the same visitor (in different places of the code,
                  so passing all the <code>std::variant</code>s at the same time to <code>std::visit</code> was not viable).</p>
                  <p>Sure, I could quickly write a lambda to do the job:</p>
                  <pre><code class="language-cpp">auto visitWith = [](auto const&amp; visitor){
  return [](auto const&amp;... variants){
    return std::visit(visitor, variants...);
  };
};</code></pre>
                  <p>but why should I, if there's already the <a href="http://boostorg.github.io/hana/">Boost.Hana</a> library out there that offers
                  <a href="http://boostorg.github.io/hana/group__group-functional.html#ga778b2daa27882e71d28b6f2b38982ddf"><code>hana::partial</code></a>?
                  However, to do so, I had the problem that
                  <code>std::visit</code> is a template function, so <a
                  href="https://stackoverflow.com/questions/65811716/most-terse-and-reusable-way-of-wrapping-template-or-overloaded-functions-in-func">it can't be passed around</a> just like if
                  it was an object. Easy peasy, I wrapped it in a lambda:
                  </p>
                  <pre><code class="language-cpp">auto visit = [](auto const&amp; visitor, auto const&amp;... variants){
  return std::visit(visitor, variants...);
};</code></pre>
                  <p>Yeah, I hear you: if I'm happy with this lambda, why should the previous one bother me?</p>
                  <p>Well, that's true, but the point is that stubbornly trying to use <code>hana::partial</code>
                  is what made me understand, once more, that Scott Meyers' book is a holy bible!
                  </p>

                  <h5>The problem</h5>
                  <p>Wrapping <code>std::visit</code> in the <code>visit</code>
                  object, however, wasn't enough to be able to partially
                  apply <code>visit</code> to a visitor; not in the naive code
                  I wrote,</p>
                  <pre><code class="language-cpp">auto visitor = hana::overload(
  [](auto arg)               { /* whatever */ },
  [](double arg)             { /* whatever */ },
  [](const std::string&amp; arg) { /* whatever */ });

auto visitWithVis = hana::partial(visit, visitor);</code></pre>
                  <p>which was failing to compile, <a href="https://godbolt.org/z/9GnT9fzox">with a pretty confusing error</a>, the key part of which was (in hindsight!)</p>
                  <pre><code>error: no matching function for call to ‚Äòhana::overload_t&lt;main()::&lt;lambda(double)&gt;, main()::&lt;lambda(const string&amp;)&gt; &gt;::overload_t()‚Äô</code></pre>

                  <p>Therefore I asked <a href="https://stackoverflow.com/questions/68099079/understanding-error-when-using-partial-function-application-or-curry-in-conjunct">a question on StackOverflow</a>
                  but nobody answered (for 5 months!), so today I decided to spend some time myself to find out the answer.</p>

                  <h5>The investigation</h5>
                  <p>Eventually, I was able to set up a very minimal example to reproduce the problem: </p>
                  <pre><code class="language-cpp">#include &lt;boost/hana/functional/overload.hpp&gt;
auto ovl{hana::overload(l1, l2, l3)};
using Ovl = decltype(ovl);
Ovl ovl2{ovl}; // this triggers the compilation error</code></pre>
                  <p>From the comment you understand that there's something wrong with copying the <code>ovl</code> object.
                  As suggested in <a href="https://stackoverflow.com/questions/68099079/understanding-error-when-using-partial-function-application-or-curry-in-conjunct?noredirect=1#comment123799416_68099079">a comment</a>,
                  however, making <code>ovl</code> a <code>const</code> object solves the problem, which gave me some food for thoughts.
                  </p>

                  <p>By peeping for some time into <a href="https://github.com/boostorg/hana/blob/master/include/boost/hana/functional/partial.hpp"><code>hana::partial</code></a>
                                    and <a href="https://github.com/boostorg/hana/blob/master/include/boost/hana/functional/overload.hpp"><code>hana::overload</code></a>
                  I could later make up a less minimal, but more meaningful example:
                                    </p>
                  <pre><code class="language-cpp">#include &lt;boost/hana/functional/overload.hpp&gt;

auto l1 = [](int){};    using L1 = decltype(l1);
auto l2 = [](double){}; using L2 = decltype(l2);
auto l3 = [](float){};  using L3 = decltype(l3);

using Ovl = hana::overload_t&lt;L1, L2, L3&gt;

Ovl ovl{l1,l2,l3};

Ovl ovl2{ovl}; // this triggers the compilation error</code></pre>
                  <p>where <code>hana::overload_t</code> is the (template) class of the object returned by <code>hana::overload</code>.</p>

                  <p>To understand what's going on, I had to look once more,
                  and for more than just a few minutes, into the implementation of
                  <a
                    href="https://github.com/boostorg/hana/blob/998033e9dba8c82e3c9496c274a3ad1acf4a2f36/include/boost/hana/functional/overload.hpp#L41-L71"><code>hana::overload_t</code></a>,
                  and to play a bit the role of the compiler, by "manually
                  instantiating" it:</p>
                  <pre><code>struct overload_t&lt;L1, L2, L3&gt;
    : L1
    , overload_t&lt;L2, L3&gt;
{
    using type = overload_t;
    using L1::operator();
    using overload_t&lt;L2, L3&gt;::operator();

    template &lt;typename F_, typename ...G_&gt;
    constexpr explicit overload_t(F_&amp;&amp; f, G_&amp;&amp; ...g)
        : L1(static_cast&lt;F_&amp;&amp;&gt;(f))
        , overload_t&lt;L2, L3&gt;(static_cast&lt;G_&amp;&amp;&gt;(g)...) // error points here
    { }
};</code></pre>

                  <h5>The solution</h5>
                  <p>It is then clear what's going on: the code <code>Ovl
                    ovl2{ovl};</code>, which should make use of the copy
                  constructor, is using instead the template member function
                  above, with <code>F_ = overload_t&lt;L1, L2,
                    L3&gt;&amp;</code> and <code>G_ = {}</code> (i.e.
                  <code>G_</code> is an empty pack), which in turn causes an
                  attempt to initialize <code>overload_t&lt;L2,
                    L3&gt;()</code>, which is erroneous and nicely maps to the
                  key part of the error I copied above.
                  </p>

                  <p>But why does the compiler try to use the template
                  constructor above, instead of the compiler-generated copy
                  constructor (the generation of which is <b>not</b> suppressed, as per <i>Item 17</i> from the same book)?</p>

                  <p>The answer is at the end of <i>Item 26</i> from Scott Meyers' <i>Effective Modern C++</i>:</p>

                  <blockquote>
                    <p>
                    <code>cloneOfP</code> is being initialized with a
                    non-<code>const</code> lvalue (<code>p</code>), and that
                    means that the templetized constructor can be instantiated
                    to take a non-<code>const</code> lvalue of type
                    <code>Person</code>
                    </p>
                    <p>
                    [&hellip;]
                    </p>
                    <p>
                    Calling the copy constructor would require adding
                    <code>const</code> [&hellip;], but calling the instantiated
                    template requires no such addition. [&hellip;] the template is thus a better match
                    </p>
                  </blockquote>
                  <p>(In our case <code>cloneOfP</code> corresponds to <code>ovl2</code>, <code>p</code> to <code>ovl</code>, and <code>Person</code> to <code>overload_t&lt;L1, L2, L3&gt;</code>.)</p>

                  <p>Thanks again, Scott, always!</p>
                </div>
              </div>
            </article>
          </section>
          <section class="tab-page" id="projects-tab">
            <article class="post-entry" id="css-radar-diagram">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">4/1/2022</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/css3-logo.png" alt="">
                  <h2>
                    <a href="#css-radar-diagram">
                      <span lang="en">CSS-only radar diagram</span>
                      <span lang="it">Diagramma a radar con solo CSS</span>
                    </a>
                  </h2>
                </div>
                <div class="text-shadow">
                  <p>
                  I still remember I was flying back or away from home when I started thinking about this webpage
                  with these thoughts coming in sequence
                  </p>
                  <ul>
                    <li>Oh, I really enjoyed <i><a href="https://www.manning.com/books/css-in-depth">CSS in Depth</a></i>,</li>
                    <li>I think I could really leverage that to make a good blog;</li>
                    <li>I should probably start by doing what I initially planned to do: putting my CV online&hellip;</li>
                    <li>&hellip; with my working experience and all my skills&hellip;</li>
                    <li>Yeah, especially all my programming skills!</li>
                    <li>A diagram with the skills would be nice&hellip;</li>
                    <li>I should try doing it without any JavaScript!</li>
                    <li>With CSS I can certainly do it!</li>
                  </ul>
                  <p>Well, the reality was not that smooth though. As soon as I
                  had put my feet literally back on earth and played around a bit,
                  I realized that there's a fundamental problem with making
                  CSS-only plots:
                  </p>
                  <ul>
                    <li>ideally, the data, e.g. the <i>x</i> and <i>y</i> coordinates of a piecewise linear plot,
                      should be contained in the HTML markup, they are part of the content of the page, having
                      nothing to do with style (CSS), let alone dynamics (JavaScript);
                    </li>
                    <li>it is reasonable to think that each pair <i>(x, y)</i> should belong to one HTML element
                      representing a "point" of the curve;
                    </li>
                    <li>then CSS should take care of "drawing" lines, curves, colors, and what not.</li>
                  </ul>
                  <p>So how should that ideal HTML look like? Probably something along these lines
                  </p>
                  <pre><code class="language-html">&lt;div class="plot"&gt;
  &lt;!-- 6 points of the y = x¬≤ parabola --&gt;
  &lt;div class="point" style="--x: 0; --y: 0;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--x: 1; --y: 1;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--x: 2; --y: 4;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--x: 3; --y: 9;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--x: 4; --y: 16;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--x: 5; --y: 25;"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
                  <p>
                  where the <i>x</i> and <i>y</i> coordinates are in the <code>style</code> attribute
                  so that CSS can pick it up easily.
                  </p>
                  <p>But now the point is the following:</p>
                  <blockquote>
                    How the heck do I draw anything, say a line, via CSS
                    according to quantities specific to two
                    <i><b>separate</b></i> elements?
                  </blockquote>
                  <p>Well, the answer is simply that <i>I cannot</i>, the reason being that,
                  in order to draw lines or more complex stuff via CSS, one has to leverage things
                  like <code>border</code>s (to draw lines), <code>background-color</code>s (to
                  draw areas), and so on. But those things are specific to <b><i>one</i></b> element,
                  and cannot bridge between two elements.
                  </p>
                  <p>Regardless of how reasonable my self-argument sounded, I couldn't really
                  just think I had the correct answer already, and so I wanted to search a bit
                  online:
                  </p>
                  <ul>
                    <li>First, searching online for "CSS plot" <i>et similia</i> I
                      generally found stuff containing <code>.js</code> written
                      here or there, sooner or later down the page, which already
                      made me feel like I could be right.
                    </li>
                    <li>Second, I found <a href="https://css-tricks.com/how-to-make-a-line-chart-with-css/">this article from <i>CSS Tricks</i></a>,
                      which links to <a href="https://www.chartjs.org/">Chart.js</a> in the first few lines, and later shows
                      a solution that features, for each HTML element
                      representing a point, not just the <code>--x</code> and
                      <code>--y</code> CSS properties, but also properties
                      <code>--hypotenuse</code> and <code>--angle</code> in a
                      nested HTML element (peep into the code and you'll see).
                      If you tamper with those, you'll see the lines detaching
                      from the points; in other words, the lines are not bound
                      to the points, and you have to recompute the values of
                      <code>--hypotenuse</code> and <code>--angle</code> by
                      hand if you change <code>--x</code> and <code>--y</code>.
                    </li>
                    <li>Finally, I found <a href="https://chartscss.org/">Chart.css</a>
                      a <i>CSS data visualization framework</i> that claims
                      <blockquote>
                        Charts.css is a modern CSS framework. It uses CSS utility classes to style HTML elements as charts.
                      </blockquote>
                      (By the way, the very chart I was looking for, <a href="https://chartscss.org/charts/radar/">the radar chart, is under development</a>
                      while I'm writing these notes.)
                    </li>
                  </ul>
                  <p>The last result was kind of illuminating.
                  Indeed, if you look at the documentation page of the maybe simplest example, the <a href="https://chartscss.org/charts/line/">line</a>,
                  you'll see that it states the following:
                  </p>
                  <blockquote>
                    When you add data, you need to supply not
                    only the data <code>--size</code> variable but also the
                    <code>--start</code> variable that indicates the
                    starting point.
                  </blockquote>
                  <p>
                  Rephrasing it (and you can verify it by playing around with the code),
                  each HTML element that represents a point in the graph must provide
                  data to the CSS not just for that point, but also for the point before it.
                  And this is in the simple scenario of piecewise linear curve; if you
                  think about something more complex, there might be need for one HTML
                  element to carry data about more neighboring points.
                  </p>
                  <p>Given this (bad) news and going back to the HTML snippet above,
                  we could rewrite it like this (where the trailing <code>p</code> of
                  <code>--xp</code> and <code>--yp</code> stands for <i>previous</i>),
                  <pre><code class="language-html">&lt;div class="plot"&gt;
  &lt;!-- 5 segments (between the 6 points) of the y = x¬≤ parabola --&gt;
  &lt;div class="point" style="--xp: 0; --yp: 0; --x: 1; --y: 1;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--xp: 1; --yp: 1; --x: 2; --y: 4;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--xp: 2; --yp: 4; --x: 3; --y: 9;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--xp: 3; --yp: 9; --x: 4; --y: 16;"&gt;&lt;/div&gt;
  &lt;div class="point" style="--xp: 4; --yp: 16;--x: 5; --y: 25;"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
                  giving a chance to our CSS to pick the coordinates of the two
                  points between which line has to be drawn.
                  </p>
                  <p>As regards how that line is drawn, I don't think there's one single
                  solution, and to be honest, I haven't bothered making up some random plots;
                  I targeted full steam ahead the radar plot I wanted.</p>
                  <p>Here are the few points on which that chart is based (I'm referring to
                  the data content of the graph, and not the meta content, aka the grid):
                  </p>
                  <ol>
                    <li>a radar diagram looks like a polygon, with as many vertices (and sides)
                      as the number of quantities we want to show, say <i>N</i>, so we need
                      to provide that <i>N</i> via a CSS property, say
                      <code>--N</code> that we can encode in the HTML in the root
                      parent of the chart;</li>
                    <li>that polygon is made up of <i>N</i> triangles;</li>
                    <li>all triangles have one vertex in common, the one at the
                      center of the chart (so let's call that vertex <i>the center</i>),
                      and the angle insisting on that vertex is the same for
                      all triangles, being it equal to 350¬∞ divided by
                      <i>N</i>; <code>position</code>, <code>left</code>, and <code>right</code>
                      CSS properties can be used to achieve the translational positioning, whereas
                      <code>transform</code> and its <code>rotate</code> value can be used to
                      achieve the angular positioning;
                    </li>
                    <li>for each triangle, the lengths of the two sides starting from the
                      center are exactly the "current" quantity and the "previous" quantity,
                      so we need to make those quantities available to the CSS, as I've already
                      explained and shown in the previous HTML snippet;</li>
                    <li>any triangle can be thought of as half of an appropriate parallelogram,
                      the half on one side of the appropriate diagonal, and any parallelogram can be thought of as a square
                      subject to anisotropic scaling (that makes it a rectangle)
                      and shear (that makes it "skewed"), so we can make use of the
                      <code>background-image</code> CSS property and setting it to
                      something along the lines of
                      <code>linear-gradient(45deg, black 50%, transparent 50%);</code>
                      to have a black orthogonal triangle, and the <code>transform</code>
                      property with its <code>skew</code> and <code>scale</code> values.
                    </li>
                  </ol>
                  <p>
                  That's mostly it, but the difficult part is actually writing CSS code
                  such that it is reusable. Doing so goes through making appropriate use
                  of <a href="https://css-tricks.com/a-complete-guide-to-custom-properties/">CSS custom properties</a>.
                  </p>
                  <p>Thoroughly inspecting my Radar plot <a href="https://aster89.github.io/#about-me">here</a>,
                  both HTML-wise and CSS-wise (via dev tools or by peeping into <a href="https://github.com/Aster89/aster89.github.io">the repo on GitHub</a>),
                  together with <a href="https://aster89.github.io/docs">the associated KSS documentation</a>,
                  should be enough to understand how the various bricks fit
                  together. But it's not the easiest of the things&hellip;
                  </p>
                  <p>A few external references:
                  </p>
                  <ul>
                    <li>the general idea about how to draw triangles came from <a href="https://css.michaelschrauzer.com/demos/css-triangles.html">eCCSplorations</a></li>
                    <li>the idea about including the "previous point" in the HTML, as said, came from <a href="https://chartscss.org/">Chart.css</a></li>
                    <li>for trigonometric computations, the built on <a href="https://gist.github.com/stereokai/7666bfe93929b14c2dced148c79e0e97">this gist from stereokai</a></li>
                    <li>all the rest comes from the already mentioned <i><a href="https://www.manning.com/books/css-in-depth">CSS in Depth</a></i></li>
                  </ul>
                  <p>
                  However, here is an example of a plot with 12 skills (in hindsight,
                  I should probably put some effort in drawing as many diameters in the
                  canvas as the are skills on the plot, but that's easier said than done,
                  considering that each of those lines is done with one dedicated
                  <code>linear-gradient</code> in the CSS):
                  </p>
                  <div class="radar-plot polar-canvas img-shadow" style=" --number-of-skills: 12; --max-skill: 5;">
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 0; --this-skill: 5; --next-skill: 3"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 1; --this-skill: 3; --next-skill: 4"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 2; --this-skill: 4; --next-skill: 1"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 3; --this-skill: 1; --next-skill: 3"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 4; --this-skill: 3; --next-skill: 3"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 5; --this-skill: 3; --next-skill: 4"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 6; --this-skill: 4; --next-skill: 2"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 7; --this-skill: 2; --next-skill: 5"></div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 8; --this-skill: 5; --next-skill: 2">
                      <div class="polar-diagram-icon polar-position">
                        <div>A</div>
                      </div>
                    </div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 9; --this-skill: 2; --next-skill: 3">
                      <div class="polar-diagram-icon polar-position">
                        <div>B</div>
                      </div>
                    </div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 10; --this-skill: 3; --next-skill: 3">
                      <div class="polar-diagram-icon polar-position">
                        <div>&hellip;</div>
                      </div>
                    </div>
                    <div class="trigonometry triangle center-origin--after skill" style="--i: 11; --this-skill: 3; --next-skill: 5"></div>
                  </div>
                  <p>
                   Notice that the markup is essentially very simple, as each
                   entry of the plot has 4 <code>class</code>es and 3 CSS
                   custom properties; here are the first two entries:
                   <pre><code class="language-html">&lt;div class="trigonometry triangle center-origin--after skill" style="--i: 0; --this-skill: 5; --next-skill: 3"&gt;&lt;/div&gt;
&lt;div class="trigonometry triangle center-origin--after skill" style="--i: 1; --this-skill: 3; --next-skill: 4"&gt;&lt;/div&gt;
&lt;div class="trigonometry triangle center-origin--after skill" style="--i: 2; --this-skill: 4; --next-skill: 1"&gt;&lt;/div&gt;
&lt;div class="trigonometry triangle center-origin--after skill" style="--i: 3; --this-skill: 1; --next-skill: 3"&gt;&lt;/div&gt;</code></pre>
                   The markup is just a bit more complicated, with two more nested elements, when we want to add some "labels"
                   to each entry; here's the entry labelled as <i>B</i>:
                   <pre><code class="language-html">&lt;div class="trigonometry triangle center-origin--after skill" style="--i: 9; --this-skill: 2; --next-skill: 3"&gt;
  &lt;div class="polar-diagram-icon polar-position"&gt;
    &lt;div&gt;B&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
                  </p>
                  <p>It is understood that using JavaScript we could
                  dynamically set <code>--next-skill</code> instead of
                  hardcoding it in the HTML, which clutters it with
                  content which is not semantically relevant.
                  </p>
                  <p>A few external references:
                  </p>
                  <ul>
                    <li>the general idea about how to draw triangles came from <a href="https://css.michaelschrauzer.com/demos/css-triangles.html">eCCSplorations</a></li>
                    <li>the idea about including the "previous point" in the HTML, as said, came from <a href="https://chartscss.org/">Chart.css</a></li>
                    <li>for trigonometric computations, the built on <a href="https://gist.github.com/stereokai/7666bfe93929b14c2dced148c79e0e97">this gist from stereokai</a></li>
                    <li>all the rest comes from the already mentioned <i><a href="https://www.manning.com/books/css-in-depth">CSS in Depth</a></i></li>
                  </ul>
                </div>
              </div>
            </article>
            <article class="post-entry" id="this-blog-sketch">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">21/11/2021</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <div class="panel-icon">
                    <img src="img/css3-logo.png" alt=""/>
                    <img src="img/html-logo.png" alt=""/>
                    <img src="img/javascript-logo.png" alt=""/>
                  </div>
                  <h2>
                    <a href="#this-blog-sketch">
                      <span lang="en">This blog</span>
                      <span lang="it">Questo blog</span>
                    </a>
                  </h2>
                </div>
                <div class="text-shadow">

                  <p>Before starting the adventure of setting up a personal blog,
                  I had never really dedicated myself to a personal programming
                  project that needs such an amount of work.</p>

                  <blockquote>In the Beginning, There Was Nothing. The Keith J. Grant Wrote <i><a href="https://www.manning.com/books/css-in-depth">CSS in Depth</a></i>.</blockquote>

                  <p>&hellip;and that's how I truly considered that I could write a blog myself.</p>

                  <p>To be precise, it all started with the slightly less pretentious aim of putting my CV online. Here's the first sketch</p>

                  <img src="img/first-sketch.jpg" alt=""/>

                  <p>But as soon as I started to feel comfortable with CSS and HTML, I also started to target somewhat
                  higher&hellip; Why not writing a blog?</p>

                  <p>Therefore I had to approach JavaScript as well, including meeting JQuery.</p>

                  <p><a
                    href="https://stackoverflow.com/search?q=%5Bcss%5D+or+%5Bjavascript%5D+or+%5Bhtml%5D+-%5Bregex%5D+-%5Bbash%5D+user%3A5825294+is%3Aquestion">Eventually,
                    I asked several question around the topic of web
                  development.</a></p>

                  <p>That's how it all started.</p>

                  <p>Well, for now nobody knows of it, but... you never know, maybe
                  somebody will start reading it&hellip;, and maybe find it useful too,
                  if they want to start a similar adventure themselves!</p>
                </div>
              </div>
            </article>
            <article class="post-entry" id="winzoz">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">01/09/2021</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <img class="panel-icon" src="img/vim-logo-png-transparent.png" alt=""/>
                  <h2>
                    <a href="#winzoz">
                      <span lang="en">Painless window navigation in Vim</span>
                      <span lang="it">Navigazione facile tra le finestre di Vim</span>
                    </a>
                  </h2>
                </div>
                <div class="text-shadow">
                  <div lang='en'>
                    <p>Today <a href="https://github.com/Aster89/WinZoZ">my
                      Vim plugin for easy window navigation</a>, which I named
                    <a href="https://nonciclopedia.org/wiki/Windows">WinZoZ</a>,
                    has got its first star! Given <a
                      href="https://stackoverflow.com/questions/69007954/vim-remap-ctrl-w-in-insert-mode-to-behave-as-it-does-in-normal-mode#comment121984179_69007954">this
                      comment on StackOverflow</a>, the star is from the user <a
                      href="https://stackoverflow.com/users/3271687/yolenoyer">@yolenoyer</a>.
                    </p>
                    <p>With this plugin you can hit <span class="key">&lt;leader&gt;</span><span class="key">w</span> to enter a
                    sort of "<span class="key">CTRL-W</span> mode", during which each key pressed will
                    be assumed preceded by <span class="key">CTRL-W</span>.</p>
                    <p>This can be very helpful, imho, if you're the kind of Vim user
                    who works with a big monitor and splits the terminal several times
                    both horizontally and vertically.</p>
                    <p>Indeed, if this is the case, chances are good
                    that you hit <span class="key">CTRL-W</span> a lot of times to move from one window
                    to another. (Search for <i><code>:help CTRL-W</code></i> to see how many commands start by <span class="key">CTRL-W</span>.)</p>
                    <p>Below is a GIF demonstrating the use of <a href="https://github.com/Aster89/WinZoZ">WinZoZ</a>:</p>
                    <img src="https://user-images.githubusercontent.com/20521900/97799961-55007280-1c31-11eb-9821-8b604345ac1b.gif" alt=""/>
                  </div>
                  <div lang='it'>
                    <p>Oggi <a href="https://github.com/Aster89/WinZoZ">il mio plugin Vim per agevolare la navigazione tra le finestre</a>, che ho chiamato
                    <a href="https://nonciclopedia.org/wiki/Windows">WinZoZ</a>,
                    ha guadagnato la sua prima stella! A giudicare da <a
                      href="https://stackoverflow.com/questions/69007954/vim-remap-ctrl-w-in-insert-mode-to-behave-as-it-does-in-normal-mode#comment121984179_69007954">questo
                      commento su StackOverflow</a>, la stella √® dall'utente <a
                      href="https://stackoverflow.com/users/3271687/yolenoyer">@yolenoyer</a>.
                    </p>
                    <p>Con questo plugin puoi premere <span class="key">&lt;leader&gt;</span><span class="key">w</span> per attivare una
                    specie di "modo <span class="key">CTRL-W</span>", durante il quale ogni tasto premuto verr√†
                    interpretato come preceduto da <span class="key">CTRL-W</span>.</p>
                    <p>Questo pu√≤ essere molto utile, secondo me se sei il tipo di utente Vim
                    che lavora con un grande monitor e divide il terminale molte volte
                    sia orizzontalmente che verticalmente.</p>
                    <p>In questo caso, infatti, ci sono buone probabilit√† che tu sia costretto a premere
                    <span class="key">CTRL-W</span> tantissime volte per muoversi da una finestra
                    all'altra. (Cerca <i><code>:help CTRL-W</code></i> per vedere quanti comandi iniziano con <span class="key">CTRL-W</span>.)</p>
                    <p>In basso c'√® una GIF dimostrativa dell'utilizzo di <a href="https://github.com/Aster89/WinZoZ">WinZoZ</a>:</p>
                    <img src="https://user-images.githubusercontent.com/20521900/97799961-55007280-1c31-11eb-9821-8b604345ac1b.gif" alt=""/>
                  </div>
                </div>
              </div>
            </article>
          </section>
          <section class="tab-page" id="suggested-books-tab">
            <article class="post-entry" id="not-so-clean-code">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">06/01/2022</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <h2><a href="#not-so-clean-code">Clean Code (?) - part 1</a></h2>
                </div>
                <div class="text-shadow">
                  <p>I didn't like that book.</p>
                  <p>&hellip;</p>
                  <p>(OK, maybe I should be more verbose than that.)</p>
                  <p>First of all, it's full of just Java code. With
                  such a premise, I can't hope that the author expresses
                  as general ideas as the title would imply, and indeed
                  he doesn't; what he does instead, is trying to give
                  a recipe made up of dogmatic rules for writing presumably
                  clean Java code. And given that languages evolve (I guess
                  Java does too, doesn't it? I don't know Java,
                  <strike>un</strike>fortunately), that old book is probably
                  not applicable anymore.
                  </p>
                  <p>Secondly, the book does have something good: I do agree
                  with several statements across the book, and those statements
                  are often engraved in section titles&hellip;</p>
                  <p>&hellip; but as long as examples are concerned,
                  I think they are flat out wrong: they mislead, and generally
                  go against what the titles express, at least based on the
                  few chapters I could read before giving up.
                  </p>
                  <p>And yes, this is gonna be a rant. (And it's not just my
                  rant: <i><a href="https://qntm.org/clean">It's probably time to
                      stop recommending Clean Code</a></i>.)</p>
                  <p>Take Chapter 2, <i>Meaningful Names</i>.</p>
                  <p>After an
                  <i>Introduction</i> that is as non-controversial as it is a
                  tautology, a section named <i>Use Intention-Revealing Names</i>
                  gives an example of a badly named variable
                  </p>
                  <blockquote>
                    <pre><code class="language-java">int d; // elapsed time in days</code></pre>
                    The name <code>d</code> reveals nothing.
                  </blockquote>
                  <p>
                  followed by examples of presumably better names for variables representing time
                  </p>
                  <blockquote>
                    We should choose a name that specifies what is being
                    measured and the unit of that measurement:
                    <pre><code class="language-java">int elapsedTimeInDays;
int daysSinceCreation;
int daysSinceModification;
int fileAgeInDays;</code></pre>
                  </blockquote>
                  <p>Now, I do understand and appreciate the suggestion of giving
                  a name that <i>specifies what is being measured</i>; after all,
                  if I don't know what a variable <i><b>is</b></i>, how can
                  I make use of it or understand how the surrounding code uses it?</p>
                  <p>On the other hand, I can't help notice that all those
                  variables are <code>int</code>s and that their names contain the
                  word <i>days</i>.
                  </p>
                  <p>What does that make me think? That
                  <code><b>days</b>SinceCreation</code> is sitting there just
                  waiting to be subtracted to
                  <code><b>seconds</b>SinceTheEpoch</code>, and the difference to be assigned
                  to <code><b>day</b>OfCreation</code>, resulting in a
                  wonderfully cinematographic temporal paradox that features us
                  travelling to a very far future to create a new file that has always existed&hellip;
                  (I hope the joke is not too obscure&hellip; the bold text should help)
                  </p>
                  <p>So going back to the suggestion, my question is: why should I
                  encode the unit of measure in the name of the variable? The age
                  of a file is just time, whether I express it in days or in seconds.
                  The <code>fileAge</code> part of the name <code>fileAgeInDays</code>
                  is semantically relevant, as it tells me what that variable represents
                  in the piece of code I'm reading. But the <code>InDays</code> part
                  is just an implementation detail.
                  </p>
                  <p>I hear somebody saying <q>once I have decided that I use an <code>int</code>
                  to represent time, I have to encode in the variable names what is
                  the unit of measure of that time, otherwise I risk adding apples and
                  oranges</q>. My answer is that this approach is
                  flawed since the beginning: if you are worried about an <code>int</code> representing
                  a time in days being added to an <code>int</code> representing time in years,
                  that means that <code>int</code> is just not the right type for you,
                  and that you should use a type that handles the unit of measurement
                  automatically.
                  </p>
                  <p>(To know more about this, I suggest reading
                  <a href="https://www.fluentcpp.com/2016/12/05/named-constructors/" target="_blank">
                    the series on strong types by Jonathan Boccara</a>,
                  which I find excellent.)
                  </p>
                  <p>I hear somebody else saying <q>come on, it was just an example!</q>,
                  and my answer is
                  </p>
                  <ul>
                    <li>this is a book about about writing clean code, so it
                      should have been damn careful when giving examples</li>
                    <li>tell me what the cost of writing the above snippet like
                      this would have been:
                      <pre><code class="language-java">Time elapsedTime;
Time timeSinceCreation; // a better name is probably just "age"
Time timeSinceModification;
Time fileAge;</code></pre>
                      <code>Time</code> just screams <q>no worries, I'm the one
                      handling the units</q>. (No, starting a variable name with <code>time</code>
                    in this case is not duplicating information already contained in the type, but is disambiguating:
                    using a standalone <code>sinceCreation</code> we wouldn't know if that is a time
                    or a number of events, just to say; <code>fileAge</code> encodes the "time-ness"
                    in the <code>Age</code> part, so we don't need <code>time</code> in its name.)
                    </li>
                  </ul>
                  <p>Then Martin claims that it's hard to tell what the following code is doing
                  </p>
                  <blockquote>
                    <pre><code class="language-java">public List&lt;int[]&gt; getThem() {
  List&lt;int[]&gt; list1 = new ArrayList&lt;int[]&gt;();
  for (int[] x : theList)
  if (x[0] == 4)
    list1.add(x);
  return list1;
}</code></pre>
                  </blockquote>
                  <p>
                  which I can't disagree with, but I feel there are two candidates
                  for why the code is not clear:
                  </p>
                  <ol>
                    <li>the names of the variables are badly chosen</li>
                    <li>the code mixes two levels of abstraction and
                      hard codes stuff that should be named appropriately
                      and taken as input</li>
                  </ol>
                  <p>Uncle Bob obviously picks number 1 and goes full steam on
                  his crusade, but we disagree even earlier than that, when he
                  writes <q>There aren't even any fancy classes or polymorphic
                  methods</q>, which for me just means that somebody is
                  easily scared by generic code.
                  </p>
                  <p>Anyway, he eventually shows us his shiny code
                  </p>
                  <blockquote>
                    <pre><code class="language-java">public List&lt;Cell&gt; getFlaggedCells() {
  List&lt;Cell&gt; flaggedCells = new ArrayList&lt;Cell&gt;();
  for (Cell cell : gameBoard)
    if (cell.isFlagged())
      flaggedCells.add(cell);
  return flaggedCells;
}</code></pre>
                    With these simple name changes, it's not difficult to understand what's going on. This is
                    the power of choosing good names.
                  </blockquote>
                  <p>
                  Incidentally, where does <code>gameBoard</code> come from?
                  It's a global variable, which means
                  <code>getFlaggedCells()</code> function has side effects: it
                  will return different output without you changing the inputs
                  you pass to it (yeah, it doesn't take inputs, which is a symptom
                  of impurity). A few pages later Uncle Bob will suggest that
                  code should not have side effect. What a undecided man&hellip;
                  </p>
                  <p>I don't know how understandable that code is if you don't
                  <b>parse</b> it, just as you were the compiler (or the JVM,
                  or whatever it's needed to run that crap), but I know that
                  Uncle Bob will write the following code somewhere else (modulo
                  <i>I-don't-know-Java-sorry</i>)
                  </p>
                  <pre><code class="language-java">public Set&lt;Book&gt; getProgrammingBooks() {
  Set&lt;Book&gt; programmingBooks = new ArraySet&lt;Book&gt;();
  for (Book book : libraryShelf)
    if (book.isOnProgramming())
      programmingBooks.add(book);
  return programmingBooks;
}</code></pre>
                  <p>
                  And guess what's the difference? None! The two codes are just
                  doing the same thing: filtering a container according to a
                  predicate (a.k.a. I've just renamed the variables/types/names
                  to make the latter snippet from the former).
                  </p>
                  <p>So why should we write those two functions, instead
                  of writing just one generic function that we use in
                  the context we need? Again, I don't know any Java, but
                  I guess this pseudo-Java conveys what I mean:
                  </p>
                  <pre><code class="language-java">public Container&lt;Item&gt; filter(Container&lt;Item&gt; container, Pred pred) {
  Container&lt;Item&gt; newCont = new ArrayContainer&lt;Item&gt;();
  for (Item item : container)
    if (pred(item))
      newCont.add(item);
  return newCont;
}</code></pre>
                  <p>Notice that this piece of code above is closer to the initial
                  version (of which Uncle Bob says that telling what it does it's not easy)
                  than it is to the questionably refined one:
                  </p>
                  <ul>
                    <li>The original version
                      <ul>
                        <li class="bad">used specific types, such as <code>List</code>, <code>ArrayList</code>, and <code>int</code>,</li>
                        <li class="bad">hard-coded the predicate,</li>
                        <li class="bad">depended on a global variable,</li>
                        <li class="good">but at least used names that were not bound to the specific domain <i>of the caller</i>
                          (even though they uselessly hard-code informations which is already encoded in the type,
                          e.g. why calling a <code>List</code> <code>theList</code>?);</li>
                      </ul>
                    </li>
                    <li>uncle Bob's final version
                      <ul>
                        <li class="bad">kept using specific types, such as <code>List</code>, <code>ArrayList</code>, <code>Cell</code>,</li>
                        <li class="bad">kept hard-coding the predicate,</li>
                        <li class="bad">kept depending on a global variable,</li>
                        <li class="bad">used the caller's domain-specific names for the variables;</li>
                      </ul>
                    </li>
                    <li>my version
                      <ul>
                        <li>well, by <code>Container</code> I mean a generic type, but I don't know how to do that in Java,</li>
                        <li class="good">takes the predicate as an input argument,</li>
                        <li class="good">takes the input collection as an input argument,</li>
                        <li class="good">uses generic names that don't commit to any specific domain the caller could choose to use it for.</li>
                      </ul>
                    </li>
                  </ul>
                  <p>
                  And if the C++ programmer that I am were to kick in,
                  then I would say that if your language doesn't have
                  a library function for filtering a container,
                  then you'd better change the language.
                  </p>
                  <p>Here's a C++11 solution, which uses the <a href="https://en.wikipedia.org/wiki/Erase-remove_idiom">erase-remove idiom</a>:
                  <pre><code class="language-cpp">template&lt;typename Container, typename Predicate&gt;
Container filter(Container c, Predicate p) {
    c.erase(std::remove_if(c.begin(), c.end(), p), c.end());
    return c;
}</code></pre>
                  and finally here a C++17,
                  <pre><code>#include &lt;range/v3/view/filter.hpp&gt;
using ranges::views::filter;</code></pre>
                  and here a C++20 solution,
                  <pre><code>#include &lt;ranges&gt;
using std::ranges::views::filter;</code></pre>
                  <q>What's that?! Just an <code>#include</code> and a <code>using</code>?</q>
                  Yeah, because in both cases the function for filtering
                  is just there, in the appropriate header and in the
                  appropriate namespace, and you can easily use it
                  <a href="https://godbolt.org/z/7xTEKqPjW">
                    <pre><code>auto w = filter(v, pred);  // these two
auto w = v | filter(pred); // are equivalent</code></pre>
                  </a>
                  </p>
                  <p>
                  Going back to my claim that Martin's code mixes two levels of abstraction,
                  now it should be clearer: he prompts us to name every aspect
                  that is <i><b>inside the body of that function</b></i>
                  according to the use that the <i><b>caller</b></i> makes of it, which clearly
                  depends on the domain of the caller: in his example a board game, in my
                  counter example the old library down the road. In some way,
                  the specific use-case that the caller makes of this function, which
                  is at a given level of abstraction,
                  has leaked into the function, the content of which, says
                  Martin, should be one abstraction level lower than its call site (exact quote is
                  <q>Notice that the three steps of the function are one level
                    of abstraction below the stated name of the function</q>, at the top
                  of page 36).


                  This is clearly in contrast
                  with page 33, first paragraph, where he (righteously) claims
                  that mixing too many levels of abstractions in a function is
                  a bad thing.
                  </p>
                  <p>
                  But the function's implementation screams <q>I'm not so dumb, I can
                  do much more!</q>, and naming stuff as Martin suggests just makes
                  us deaf to that call.
                  </p>
                  <p>Clearly, another thing that deafens us is designing
                  the function such that it takes no arguments (another
                  dogmatic, unjustified, and flat out wrong suggestion that
                  Martin dispenses in the next chapter, Chapter 3), implying
                  that it writes or at least reads from some global state.
                  Because of that, we could erroneously think:
                  </p>
                  <ul>
                    <li>
                      <q>I can filter "things"; if my function takes no
                        "things" in input, how can it be a filter?</q>
                    </li>
                    <li><q>Filtering is done according to a predicate, but my
                        function takes no predicate.</q></li>
                  </ul>
                  <p>Therefore, blindly following Martin's prescriptions will
                  indirectly lead us to make a lot of code duplication, because
                  the names chosen his way will prevent us from seeing common patterns.
                  This is clearly in contrast with what he writes at page 32, first
                  paragraph, where he (righteously) refers code duplication as a bad thing.
                  </p>
                  <p>Then the crusade goes on in a (slightly) less controversial way:
                  </p>
                  <blockquote>
                    <h5>Avoid Disinformation</h5>
                    <p>
                    [&hellip;]
                    </p>
                    <p>
                    A truly awful example of disinformative names would be the
                    use of lower-case L or uppercase O as variable names,
                    especially in combination. The problem, of course, is that
                    they look almost entirely like the constants one and zero,
                    respectively.
                    </p>
                    <pre><code class="language-java">int a = l;
if ( O == l )
  l = O1;
else
  a = 01;</code></pre>
                  </blockquote>
                  <p>
                  I can't disagree, in general, but I'd say that the example is again
                  silly: the IDE will show <code>O1</code> and <code>01</code> in different
                  colors, because the former is a variable name and the latter a numeric
                  literal. <q>What if my IDE doesn't?</q> Then why are you still using it?
                  </p>
                  <p>Oh, I appreciate a footnote related to the use of <code>a</code> and
                  <code>the</code> prefixes for local variables and function arguments
                  (<strike>arguments</strike> parameters, Uncle Bob):
                  </p>
                  <blockquote>
                    Uncle Bob used to do this in C++ but has given up the practice because modern IDEs make it unnecessary.
                  </blockquote>
                  <p>Going forward, about <i>Make Meaningful Distinctions</i>,
                  </p>
                  <blockquote>
                    Number-series naming <code>(a1, a2, .. aN)</code> is the opposite of intentional naming. Such
                    names are not disinformative‚Äîthey are noninformative; they provide no clue to the
                    author's intention.
                  </blockquote>
                  <p>
                  &hellip; except if I'm coding a mathematical function that traditionally uses
                  that well known "number-series naming" convention.
                  </p>
                  <p>And then:</p>
                  <blockquote>
                    <pre><code class="language-java">getActiveAccount();
getActiveAccounts();
getActiveAccountInfo();</code></pre>
                    How are the programmers in this project supposed to know which of these functions to call?
                  </blockquote>
                  <p>
                  <p>Now jump at page 51, Listing 3-7 (Chapter 3),
                  and you'll find two member functions named <code>includeSetupPages()</code>
                  and <code>includeSetupPage()</code> respectively. It is true
                  that the former is public whereas the latter is private, so
                  a user of that class won't have a chance to be in doubt of
                  which one they have to call. But the current chapter is
                  demonizing the coexistence of a singular with its plural
                  for the sake of it.
                  </p>
                  Anyway, while I might agree that <code>getActiveAccountInfo</code> vs
                  <code>getActiveAccount</code> can (and maybe <b>is</b>)
                  confusing, why should <code>getActiveAccount</code> vs
                  <code>getActiveAccounts</code> be confusing at all? It's clear that
                  the former gives one account and the latter some collection
                  of accounts. What's the problem with that? I mean, is the following
                  not clear?
                  </p>
                  <pre><code class="language-cpp">for (Item item : items)
    // do something with this item</code></pre>
                  <p>Then the crusade goes on and targets single-letter names,
                  luckily admitting that they can be acceptable in short contexts
                  (the claim that <q>the length of a name should correspond to
                    the size of its scope</q> is simply hilarious, though).
                  </p>
                  <p>Once more into madness with this code,</p>
                  <pre><code class="language-java">for (int j=0; j&lt;34; j++) {
  s += (t[j]*4)/5;
}</code></pre>
                  <p>which is claimed to be unclear, versus this,
                  </p>
                  <pre><code class="language-java">int realDaysPerIdealDay = 4;
const int WORK_DAYS_PER_WEEK = 5;
int sum = 0;
for (int j=0; j &lt; NUMBER_OF_TASKS; j++) {
  int realTaskDays = taskEstimate[j] * realDaysPerIdealDay;
  int realTaskWeeks = (realdays / WORK_DAYS_PER_WEEK);
  sum += realTaskWeeks;
}</code></pre>
                  <p>which, in my opinion, just hides the fact that the we have just
                  a trivial application of <code>transform</code>/<code>map</code> followed
                  by a <code>reduce</code>/<code>accumulate</code> (unfortunately not
                  all languages agree on how these general purpose utilities are called, sigh).
                  </p>
                  <p>
                  Indeed, in JavaScript, you'd write the above as
                  </p>
                  <pre><code class="language-javascript">taskEstimate.map(x =&gt; x*4/5).reduce((x, y) =&gt; x + y)</code></pre>
                  <p>
                  or even more clearly like
                  </p>
                  <pre><code class="language-javascript">_.sum(_.map(taskEstimate, _.multiply(4/5))) // lodash
_.sum(_.map(_.multiply(4/5), taskEstimate)) // lodash/fp
</code></pre>
                  <p>
                  if you use <a href="https://lodash.com/docs/4.17.15">Lodash</a>/<a href="https://github.com/lodash/lodash/wiki/FP-Guide">lodash/fp</a>.
                  </p>
                  <p><q>But it was just an example!</q> Good, thanks. And what do I get from
                  a book on programming which has silly examples? Philosophy?</p>
                  <p>As regards using searchable names, I agree, but if you are
                  in need of searching the codebase for the running index of a
                  <code>for</code> loop on an array, then either you have no
                  idea what debugging is, or you're dealing with much bigger
                  problem with the surrounding code, so finding that index won't
                  really help you much. After all, if I have a for loop running
                  on the indices of a vector/array (why am I doing this in
                  2022, by the way?), then why should I name that index other than
                  <code>i</code> or <code>j</code>?  It is just a number to
                  loop on the array/vector, it is an implementation detail.
                  </p>
                  <p>Good news is that Martin suggests that we shouldn't use
                  <code>m_</code> prefixes for member variables anymore. Praise
                  the lord!</p>
                  <p>Here's another couple of suggestions which are truly Java-specific:</p>
                  <ul>
                    <li>Classes and objects should have noun or noun phrase names</li>
                    <li>Method Names Methods should have verb or verb phrase names</li>
                  </ul>
                  <p>Sure, and what if a class exists for the sole purpose of providing
                  a method (especially in a language like Java, where everything is a class)?
                  What do I call it then? <code>ClassForMethod<i>MethodName</i></code>?
                  The point is that objects and functions are just the same thing,
                  artificially made different by several (most?) languages; establishing
                  different naming rules is equivalent to encoding the weakness of the
                  language in code. Take <code>std::equal_to</code> in C++: it is a class,
                  but it has a call operator, and we are just meant to use an
                  object of that class, <code>std::equal_to&lt;&gt;{}</code>,
                  as it was a function.
                  </p>
                  <p>Eventually, there's one point I strongly agree with, in the
                  <i>Final Words</i> of this chapter (my emphasis):</p>
                  <blockquote>
                    The hardest thing about choosing good names is that it
                    requires good descriptive skills and a <b>shared cultural
                    background</b>.  This is a <b>teaching issue</b> rather
                  than a technical, business, or management issue.
                  </blockquote>
                  which prompts me to ask a question:
                  <blockquote>Should I write code as if my grandma
                  was to read it? Or should you be willing to learn
                  continuously during your life of programmer, thus
                  lifting your cultural background up with time?</blockquote>
                  <p>&hellip; and this was most I had to say about Chapter 2.</p>
                </div>
              </div>
            </article>

            <article class="post-entry" id="oreilly-clojure-programming">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">30/12/2021</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header center-text-horz">
                  <h2><a href="#oreilly-clojure-programming">Clojure Programming</a></h2>
                  <img class="panel-icon" src="img/Clojure_logo.png" alt=""/>
                </div>
                <div class="text-shadow">
                  <p>In this post, I'm collecting my thoughts on the <a
                    href="https://www.oreilly.com/library/view/clojure-programming/9781449310387/"><i>Clojure Programming</i></a>
                  book published by O'Reilly.</p>

                  <p>
                  At page 165, in the middle of the section named <i>Promises</i>, the authors claim that
                  </p>
                  <blockquote>
                    An immediately practical application of promises is in easily making callback-based APIs synchronous.
                  </blockquote>
                  <p>
                  and then propose this asynchronous function,
                  </p>
                  <pre><code class="language-clojure">(defn call-service
  [arg1 arg2 callback-fn]
  ; ... do stuff
  (future (callback-fn (+ arg1 arg2) (- arg1 arg2))))</code></pre>
                  <p>
                  this synchronous wrapper,
                  </p>
                  <pre><code class="language-clojure">(defn sync-fn
  [async-fn]
  (fn [&amp; args]
    (let [result (promise)]
      (apply async-fn (conj (vec args) #(deliver result %&amp;)))
      @result)))</code></pre>
                  <p>
                  and this use case,
                  </p>
                  <pre><code class="language-clojure">((sync-fn call-service) 10 7) ; (17 3)</code></pre>
                  <p>What puzzled me of this solution, is the fact that
                  <code>sync-fn</code> doesn't really preserve
                  <code>call-service</code>'s API: we can't even pass a
                  callback function to
                  <code>call-service</code> anymore, because the callback is
                  encoded in <code>sync-fn</code> itself, specifically in the
                  function literal (aka lambda) <code>#(deliver result %&amp;)</code>
                  which entangles together two businesses
                  </p>
                  <ul>
                    <li>executing a pure function on the inputs (the two inputs
                      that <code>call-service</code> passes to
                      <code>callback-fn</code>);
                    </li>
                    <li>populating the <code>result</code> promise via the
                      non-pure <code>deliver</code> utility.
                    </li>
                  </ul>
                  <p>
                  Indeed, <code>#(deliver result %&amp;)</code> is a variadic function
                  that wraps all its arguments into a sequence, via <code>%&amp;</code>,
                  and then passes that sequence as the second argument to <code>deliver</code>,
                  so we can rewrite it as the composition of those two businesses
                  </p>
                  <pre><code class="language-clojure">; equivalent to #(deliver result %&amp;)
(comp (partial deliver result) list)</code></pre>
                  <p>It is apparent, at this point, that <code>list</code> is just one possible
                  function that we want <code>call-service</code> to use on <code>callback-fn</code>'s
                  arguments, so there's no reason for hard-coding it into <code>sync-fn</code>.
                  </p>
                  <p>
                  In fact, we can make it an input to <code>sync-fn</code>:
                  </p>
                  <pre><code class="language-clojure">(defn sync-fn
  [async-fn callback-fn]
  (fn [&amp; args]
    (let [result (promise)]
      (apply async-fn (conj (vec args)
                            (comp (partial deliver result) callback-fn)))
      @result)))</code></pre>
                  <p>
                  which can then be used like this
                  </p>
                  <pre><code class="language-clojure">((sync-fn call-service list)          10 7) ; (17 3)
((sync-fn call-service vector)        10 7) ; [17 3]
((sync-fn call-service #(apply + %&amp;)) 10 7) ; 20
((sync-fn call-service #(apply * %&amp;)) 10 7) ; 51</code></pre>
                  <p>
                  where we pass, as <code>sync-fn</code>'s second argument, the same lambda
                  we would pass to <code>call-service</code> as a third argument.
                  </p>
                  <p>This way, <code>sync-fn</code> doesn't even need any change in the face of
                  changes in what <code>call-service</code> expects the callback to look like
                  (even though the fact that <code>call-service</code> expects the callback
                  function as the last argument is still hard-coded in <code>sync-fn</code>).
                  For instance, if <code>call-service</code> expected a <code>callback-fn</code>
                  that takes a list of arguments rather than distinct arguments,
                  </p>
                  <pre><code class="language-clojure">(defn call-service-2
  [arg1 arg2 callback-fn]
  ; ... do stuff
  (future (callback-fn (list (+ arg1 arg2) (- arg1 arg2)))))</code></pre>
                  <p>
                  then we'd only need to adapt the callback lambdas by making them accept
                  one argument instead of many:
                  </p>
                  <pre><code class="language-clojure">((sync-fn call-service-2 identity)          10 7) ; (17 3)
((sync-fn call-service-2 vec)               10 7) ; [17 3]
((sync-fn call-service-2 (partial apply +)) 10 7) ; 20
((sync-fn call-service-2 (partial apply *)) 10 7) ; 51</code></pre>
                </div>
              </div>
            </article>
          </section>
          <section class="tab-page" id="about-me-tab">
            <div class="programming-skills">
              <h2 lang="en" class="handwriting center-text-horz">Programming skills</h2>
              <h2 lang="it" class="handwriting center-text-horz">Conoscenze di programmazione</h2>
              <div id="radar-plot">
                <div class="radar-plot polar-canvas centered-container img-shadow" style=" --number-of-skills: 6;">
                  <div class="entries">
                    <div style="--i: 0; --tag-name: c++;">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 5; --next-skill: 4.5; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/c++-logo.png" alt="C++" title="c++">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                    <div style="--i: 1; --tag-name: bash;">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 4.5; --next-skill: 4; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/bash-logo.png" alt="bash" title="bash">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                    <div style="--i: 2; --tag-name: css;">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 4; --next-skill: 3.5; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/css3-logo.png" alt="CSS" title="css">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                    <div style="--i: 3; --tag-name: html;">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 3.5; --next-skill: 2.5; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/html-logo.png" alt="HTML" title="html">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                    <div style="--i: 4; --tag-name: javascript;">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 2.5; --next-skill: 3.5; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/javascript-logo.png" alt="JS" title="javascript">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                    <div style="--i: 5; --tag-name: haskell;" id="haskell-icon">
                      <div class="imho trigonometry triangle center-origin--after skill" style="--this-skill: 3.5; --next-skill: 5; --max-skill: 5;">
                        <div class="polar-diagram-icon polar-position">
                          <img src="img/haskell_logo_2.png" alt="Haskell" title="haskell" id="haskell-icon">
                        </div>
                      </div>
                      <div class="from-stackoverflow trigonometry triangle center-origin--after skill">
                        <div class="polar-diagram-icon polar-position">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="loader-wheel center"></div>
                </div>
                <div class="legend">
                  <div class="legend-entry imho">
                    <span lang="en">Self-assessment</span>
                    <span lang="it">Autovalutazione</span>
                  </div>
                  <div class="legend-entry from-stackoverflow">
                    <img src="img/stackoverflow-icon.png" alt=""/>
                    Stack Overflow
                  </div>
                </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">06/2020&mdash;present</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting">
                    <span lang="en">C++ Software Engineer</span>
                    <span lang="it">Sviluppatore C++</span>
                  </h2>
                  <div>
                    <img class="panel-icon" src="img/MATLABlogo.png" alt=""/>
                    <h3>MathWorks, Cambridge (<span lang="en">UK</span><span lang="it">Regno Unito</span>)</h3>
                  </div>
                </div>
                <div class="text-shadow">
                  <p lang="en">Design, development, and testing of text comparison back-end tools and algorithms.</p>
                  <p lang="it">Design, sviluppo, e test di algoritmi e strumenti di back-end per confronto di testi</p>
                  <h4 lang="en">Expertise:</h4>
                  <h4 lang="it">Esperienza con:</h4>
                  <ul>
                    <li>C++17</li>
                    <li>template meta-programming</li>
                    <li>SFINAE</li>
                    <li>concepts</li>
                    <li>Boost, Boost.Hana, Range-v3</li>
                    <li lang="en">functional programming</li>
                    <li lang="it">programmazione funzionale</li>
                    <li>Google Benchmark</li>
                    <li>Google Test</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">04/2019&mdash;05/2020</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting">
                    <span lang="en">Application Support Engineer</span>
                    <span lang="it">Supporto tecnico</span>
                  </h2>
                  <div>
                    <img class="panel-icon" src="img/MATLABlogo.png" alt=""/>
                    <h3>MathWorks, Cambridge (<span lang="en">UK</span><span lang="it">Regno Unito</span>)</h3>
                  </div>
                </div>
                <div class="text-shadow">
                  <div lang="en">
                    <h4>Main roles:</h4>
                    <ul>
                      <li>Phone/e-mail tech support</li>
                      <li>training assistant at JLR</li>
                      <li>MATLAB Expo</li>
                      <li>lead computer science weekly meetings</li>
                      <li>coaching new hires</li>
                      <li>technical interviews</li>
                    </ul>
                    <h4>Development C++ projects:</h4>
                    <ul>
                      <li>Implementation of Kuo&amp;Cross longest common subsequence algorithm</li>
                      <li>Transition 3p library ‚Üí internal library for HTTP requests</li>
                    </ul>
                  </div>
                  <div lang="it">
                    <h4>Compiti principali:</h4>
                    <ul>
                      <li>Supporto tecnico telefonico e tramite e-mail</li>
                      <li>Assistente trainer presso Jaguar-Land Rover</li>
                      <li>MATLAB Expo</li>
                      <li>Direzione di incontri settimanali su temi di computer science</li>
                      <li>Training di nuovi assunti</li>
                      <li>Interviste tecniche per assunzione</li>
                    </ul>
                    <h4>Progetti di sviluppo in C++:</h4>
                    <ul>
                      <li>Scrittura di algoritmo di Kuo&amp;Cross per il calcolo della <i>longest common subsequence</i></li>
                      <li>Transizione da libreria esterna a libraria interna per richieste HTTP</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">2015&mdash;2018</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting">Ph.D. in <span lang="en">Aerospace Engineering</span><span lang="it">Ingegneria Aerospaziale</span></h2>
                  <div>
                    <img class="panel-icon" src="https://seeklogo.com/images/U/Universit_and__224__degli_Studi_di_Napoli_Federico_II-logo-D9EDF680E8-seeklogo.com.png" alt=""/>
                    <h3><span lang="en">Federico II, Naples (Italy)</span><span lang="it">Federico II, Napoli (Italia)</span></h3>
                  </div>
                </div>
                <!-- XXX: to embed PDF in HTML:
                  https://stackoverflow.com/questions/17784037/how-to-display-pdf-file-in-html -->
                  <div class="text-shadow">
                    <h4>
                      <span lang="en">Thesis</span>
                      <span lang="it">Lavoro di tesi</span>
                    </h4>
                    <p>
                    <span lang="en">Development of a 3D fluid-dynamic solver for turbulent flows from scratch</span>
                    <span lang="it">Sviluppo da zero di un solutore fluidodinamico tridimensionale per flussi turbulent</span>
                    </p>
                    <ul>
                      <li>
                        <span lang="en">Object-Oriented Fortran 2003/2008 + MPI 3.1-parallel</span>
                        <span lang="it">Fortran 2003/2008 orientato agli oggetti, parallelizzato tramite MPI 3.1</span>
                      </li>
                      <li>
                        <span lang="en">employed MPI three-dimensional domain decomposition</span>
                        <span lang="it">Utilizzo di decomposizione tridimensionale del dominio</span>
                      </li>
                    </ul>
                  </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">2012&mdash;2015</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting"><span lang="en">Master degree in Aerospace Engineering</span><span lang="it">Laurea specialistica in Ingegneria Aerospaziale</span></h2>
                  <div>
                    <img class="panel-icon" src="https://seeklogo.com/images/U/Universit_and__224__degli_Studi_di_Napoli_Federico_II-logo-D9EDF680E8-seeklogo.com.png" alt=""/>
                    <h3><span lang="en">Federico II, Naples (Italy)</span><span lang="it">Federico II, Napoli (Italia)</span></h3>
                  </div>
                </div>
                <div>
                  <p><span lang="en">Final grade</span><span lang="it">Voto finale</span>: <b>110/110 <span lang="en">cum laude</span><span lang="it">e lode</span></b></p>
                  <p><span lang="en">Thesis title</span><span lang="it">Titolo della tesi</span>: <b><i>Parallel implementation of compact schemes for Navier-Stokes simulations</i></b></p>
                  <ul>
                    <li>Description: Compact finite difference numerical schemes are implicit in space, thus
                      requiring the solution of linear systems in order to be used. Parallelization opportunities
                      in applying such schemes have been investigated from the algorithmic point of view
                      and tested on 2D benchmarks.</li>
                    <li>Contribution: An original method has been developed which uses explicit estimates of
                      derivatives to decouple the algebraic systems.</li>
                    <li>Results: The method shows dissipation properties to be reduced by 75% with respect
                      to more standard approaches.</li>
                  </ul>
                  <p><span lang="en">Favourite courses:</span><span lang="it">Corsi che ho preferito:</span></p>
                  <ul>
                    <li>Multimedia signal processing</li>
                    <li>Control theory</li>
                    <li>Complements of gas dynamics (e.g. shockwave structure)</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">2008&mdash;2011</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting"><span lang="en">Bachelor degree in Aerospace Engineering</span><span lang="it">Laurea triennale in Ingegneria Aerospaziale</span></h2>
                  <div>
                    <img class="panel-icon" src="https://seeklogo.com/images/U/Universit_and__224__degli_Studi_di_Napoli_Federico_II-logo-D9EDF680E8-seeklogo.com.png" alt=""/>
                    <h3><span lang="en">Federico II, Naples (Italy)</span><span lang="it">Federico II, Napoli (Italia)</span></h3>
                  </div>
                </div>
                <div>
                  <p><span lang="en">Final grade</span><span lang="it">Voto finale</span>: <b>110/110 <span lang="en">cum laude</span><span lang="it">e lode</span></b></p>
                  <p><span lang="en">Thesis title</span><span lang="it">Titolo della tesi</span>: <b><i>Convective heat transfer measurements in transitional circular and chevron jets</i></b></p>
                  <ul>
                    <li>
                      <span lang="en">Description: Study of "cooling" capabilities of Chevron impinging jets</span>
                      <span lang="it">Descrizione: Studio della capacit√† di raffreddamento di un getto Chevron impingente</span>
                    </li>
                    <li>
                      <span lang="en">Contribution: Experimental campaign consisted in heat transfer measurements by means of a thermographic camera</span>
                      <span lang="it">Contributo: Campagna sperimentale consistita in misurazioni di scambio termico tramite camera termografica</span>
                    </li>
                  </ul>
                  <p><span lang="en">Favourite courses:</span><span lang="it">Corsi che ho preferito:</span></p>
                  <ul>
                    <li>
                      <span lang="en">Numerical methods (FD, FV, FEM)</span>
                      <span lang="it">Metodi numerici (DF, VF, MEF)</span>
                    </li>
                    <li>
                      <span lang="en">Aerodynamics</span>
                      <span lang="it">Aerodinamica</span>
                    </li>
                    <li>
                      <span lang="en">Thermodynamics</span>
                      <span lang="it">Termodinamica</span>
                    </li>
                    <li>
                      <span lang="en">Gasdynamics</span>
                      <span lang="it">Gasdinamica</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="cv-entry">
              <div class="__after-only-child-center-below centered-container">
                <h6 class="text-shadow handwriting underline-underbullet">2003&mdash;2008</h6>
              </div>
              <div class="panel panel--rounded box-shadow text-shadow">
                <div class="panel__header panel__header--two-children center-text-horz">
                  <h2 class="handwriting"><span lang="en">High school diploma</span><span lang="it">Diploma di scuola superiore</span></h2>
                  <h3><span lang="en">Liceo "Colombo", Marigliano (Naples, Italy)</span><span lang="it">Liceo "Colombo", Marigliano (Napoli, Italia)</span></h3>
                </div>
                <div>
                  <p><span lang="en">Final grade</span><span lang="it">Voto finale</span>: <b>100/100</b></p>
                  <p><span lang="en">Awards</span><span lang="it">Riconoscimenti</span>:</p>
                  <ul>
                    <li>
                      <span lang="en"><b>Bronze medal</b> at the <b>National stage</b> of "Olimpiadi della Matematica 2008" (90th classified out of 300 participants)</span>
                      <span lang="it"><b>Medaglia di bronzo</b> alla <b>fase Nazionale</b> delle "Olimpiadi della Matematica 2008" (90esimo classificato su 300 partecipanti)</span>
                    </li>
                    <li>
                      <span lang="en"><b>2nd classified</b> at <b>Provincial stage</b> of "Olimpiadi della Fisica 2008" (among ~100 participants)</span>
                      <span lang="it"><b>2¬∞ classificato</b> alla <b>fase Provinciale</b> delle "Olimpiadi della Fisica 2008" (tra ~100 partecipanti)</span>
                    </li>
                    <li>
                      <span lang="en">Top 5 classification every year at the institute competition to select participants for</span>
                      <span lang="it">Tra i primi 5 classificati ogni anno alle gare d'istituto per la selezione dei partecipanti alle</span>
                      <ul>
                        <li>Olimpiadi della Matematica</li>
                        <li>Olimpiadi della Fisica</li>
                        <li>Olimpiadi della Chimica</li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
      <!--Stuff to put somewhere
        <ul>
        <li>The importance of function objects</li>
        <li>
        about lambdas
        <ul>
        <li>http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/p0573r1.html</li>
        <li>https://artificial-mind.net/blog/2020/09/12/recursive-lambdas</li>
        </ul>
        </li>
        <li>How this site was designed</li>
        <li>boost::hana::on in JS</li>
        <li>Bird meme</li>
        <li>Reference collapsing with `const` and it's relation to the East-`const` convention</li>
        <li>How to isolate `using`s when declaring a function object in header file</li>
        <li>WinZoZ</li>
        <li>in something like `(align_words ^on^ tokenizeToWords)(sides...);`, the `^on^` is necessary</li>
        <li>Haskellize your C++</li>
        <li>about matrix with zero rows and it's transpose; types vs values</li>
        <li>importance of lazyness `const leftIndices = [...Array(leftStartsAndLengths.length).keys()].map(x => x + leftSnippet.start);`</li>
        <li>getNth</li>
        <li>unzip via drawings</li>
        <li>
template <std::size_t N>
auto toSimulinkObjectEdit(comparisons::NodeEdit<N> const& nodeEdit) {
    SimulinkObjectEdit<N> edit{};
    for (auto side : comparisons::sidesof(nodeEdit)) {
        if (auto&& maybe = side(nodeEdit)) {
            side(edit) = toSimulinkObject(*maybe);
        }
    }
    return edit;
}
am I wrong or the body could be almost return unpack(transform2(nodeEdit, toSimulinkObject), make_array);?
        </li>
        <script class="image-like" id="asciicast-UrSLE5YyCBIld7tpxtSoYgjcw" src="https://asciinema.org/a/UrSLE5YyCBIld7tpxtSoYgjcw.js" async></script>
        </ul>
        https://www.webmasterpoint.org/programmazione/html5/guida-html5/struttura-sito-header-nav-section-article-aside-footer-nuovo-doctype.html
        https://www.courseduck.com/programming/css/
        2010-08-23 http://happyworm.com/blog/2010/08/23/the-future-of-web-apps-single-page-applications/
        2011-05-28 https://blog.danwebb.net/2011/5/28/it-is-about-the-hashbangs
        2012-12-20 https://www.codeproject.com/articles/505152/anatomy-of-html5-javascript-single-page-applicatio
        2015-02-05 https://tutorialzine.com/2015/02/single-page-app-without-a-framework
        2015-03-09 https://css-tricks.com/using-the-html5-history-api/
        2015-06-18 http://tutorials.jenkov.com/html5/history-api.html
        2015-08-03 https://zinoui.com/blog/single-page-apps-html5-pushstate?amp=1
        2017-02-16 https://www.klaasnotfound.com/2017/02/16/proper-multilingual-site-with-github-pages-and-jekyll/
        2018-01-30 https://medium.com/@george.norberg/understanding-single-page-application-routing-without-a-library-or-framework-ac781b649995
        2018-06-25 https://css-tricks.com/drawing-images-with-css-gradients/
        2020-03-02 https://www.techboxweb.com/build-a-javascript-single-page-application-without-framework/
        2020-05-17 https://itnext.io/build-a-single-page-web-app-javascript-and-the-dom-90c99b08f8a9
        2021-07-28 https://css-tricks.com/using-absolute-value-sign-rounding-and-modulo-in-css-today/

        Regarding the StackOverflow API limits:
        https://meta.stackoverflow.com/questions/356419/what-is-quota-max-and-quota-remaining-in-api-stackexchange-com-2-2-users-api
        https://meta.stackexchange.com/questions/305332/getting-all-questions-with-a-specific-tag
        https://meta.stackexchange.com/questions/243773/stack-exchange-api-too-many-requests-from-this-ip-address/243798#243798
        https://stackapps.com/questions/67/how-api-keys-work-faq
        https://stackapps.com/questions/3645/do-the-terms-key-and-access-token-refer-to-the-same-thing
        -->
    </div>
    <footer class="footer panel box-shadow text-shadow">
      <div class="footer__inner panel__header">
        <span lang="it"><strike>Copiadestra</strike></span>
        Copyright &copy;
        <script>
          document.write([new Date().getFullYear()].map(x => x == 2021 ? x : "2021&mdash;" + String(x))[0])
        </script>
        Enrico Maria De Angelis
      </div>
    </footer>
  </body>
</html>
